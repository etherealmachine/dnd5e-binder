{"version":3,"sources":["serviceWorker.ts","API.ts","Compendium.ts","cards/SpellCard.tsx","TableWithCard.tsx","tabs/SpellsTab.tsx","cards/ItemCard.tsx","tabs/ItemsTab.tsx","cards/MonsterCard.tsx","tabs/MonstersTab.tsx","SearchableList.tsx","tabs/BackgroundsTab.tsx","tabs/FeatsTab.tsx","cards/ClassCard.tsx","tabs/ClassesTab.tsx","cards/RaceCard.tsx","tabs/RacesTab.tsx","TerminalCodes.ts","Shell.tsx","tabs/EncounterTab.tsx","GameState.ts","App.tsx","index.tsx"],"names":["isLocalhost","Boolean","window","location","hostname","match","registerValidSW","swUrl","config","navigator","serviceWorker","register","then","registration","onupdatefound","installingWorker","installing","onstatechange","state","controller","console","log","onUpdate","onSuccess","catch","error","API","url","req","XMLHttpRequest","Promise","resolve","reject","onreadystatechange","readyState","status","JSON","parse","responseText","statusText","open","send","this","raw_request","query","encodeURIComponent","name","Compendium","sources","backgrounds","classes","feats","items","monsters","races","spells","loaded","m","hp","num","parseInt","die","bonus","traits","trait","Array","map","texts","text","dc","modifier","find","spellcasting","spellList","replace","split","spellName","Object","values","spell","toLowerCase","trim","filter","cantrips","level","slots","NaN","concat","count","index","all","source","a","process","sourceData","loadData","compendium","entries","types","forEach","objType","attrName","hasOwnProperty","obj","slice","length","ability_score","undefined","Math","floor","isNaN","xp","cr_to_xp","sort","b","pair","ac","abilities","skills","coinage","hit_dice_for_class","encounter_difficulty","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","styles","createStyles","card","width","margin","overflowY","media","height","backgroundPosition","action","display","flexDirection","actionName","fontWeight","h5InputParent","marginBottom","h5Input","color","fontSize","lineHeight","letterSpacing","paddingTop","padding","table","textAlign","numberInputParent","maxWidth","alignSelf","titleRow","alignItems","justifyContent","SpellCard","line","i","key","props","handleCloseClicked","className","variant","onClick","time","duration","range","components","school","renderText","React","withStyles","container","flex","tableWithCard","overflow","highlight","boxSizing","borderBottom","cursor","backgroundColor","row","odd","TableWithCard","handleSearchChanged","event","setState","currentTarget","value","handleRowClick","rowData","selectedItemIndex","scrollToRow","onScrollToChange","params","tableRef","current","node","ReactDOM","findDOMNode","Grid","HTMLElement","focus","sortBy","sortDirection","SortDirection","DESC","compare","renderItemCard","children","list","includes","ASC","label","type","onChange","isControlled","columnCount","mode","rowCount","onSectionRendered","scrollToColumn","ref","headerHeight","rowClassName","noRowsRenderer","rowHeight","rowGetter","scrollToIndex","onRowClick","SpellsTab","direction","toString","dataKey","flexGrow","ItemCard","item","dmg1","dmgType","ItemsTab","parseValue","iconButton","MonsterCard","inputRef","renderAction","renderActions","actions","content","renderSpellSlots","v","c","monster","cr","passive","size","speed","str","dex","con","int","wis","cha","skill","senses","alignment","languages","description","reaction","legendary","save","resist","vulnerable","immune","conditionImmune","reactions","legendaryActions","spellSlots","classNames","modifierText","gutterBottom","MonstersTab","firstNumber","p","parseFirst","cellDataGetter","SearchableList","renderItem","BackgroundsTab","renderBackground","background","push","t","j","proficiency","FeatsTab","renderFeat","feat","ClassCard","clazz","autolevel","feature","features","textNodes","hd","spellAbility","ClassesTab","renderClass","RaceCard","race","ability","RacesTab","renderRace","TerminalCodes","n","Black","Red","Green","Yellow","Blue","Magenta","Cyan","White","Reset","Bold","Underline","Reversed","DEFAULT_PROMPT","ANSI_ESCAPE_CODES","RegExp","join","Shell","term","fitAddon","termEl","reader","program","stdin","stdout","stderr","XTerm","FitAddon","commandBuffer","tmpBuffer","historyIndex","history","suggestions","loadAddon","onData","handleData","bind","fit","startupMsg","startup","write","displayPrompt","newIndex","max","min","substring","data","charCodeAt","Up","up","Down","down","Left","left","Right","right","delete","runCommand","running","cancel","addCharacter","buf","SetColumn","prompt","call","ClearLine","ClearScreen","suggestion","SetPosition","execute","style","el","Component","Root","styled","div","EncounterTab","selection","game","selected","encounter","currentIndex","rows","e","align","initiative","conditions","aria-label","kind","Command","syntax","help","f","command","args","regex","groups","shift","group","optional","endsWith","arg","commandLine","apply","out","stringify","Error","numbers","s","some","commands","target","propertyKey","descriptor","roll","d","sum","random","repr","GameState","motd","showStartup","monsterNames","keys","savedState","localStorage","getItem","assign","setItem","startsWith","result","partial","search","msg","kinds","editDistance","distance","Levenshtein","get","from","read","resetState","maxHP","x","y","damage","saves","legendaries","times","results","parseSpellSlots","hpDesc","parseHP","parseSpellcasting","targets","removed","splice","indexOf","condition","encounterXP","reduce","playerLevels","player","levels","difficultyLevel","difficulty","xpToNextLevel","xp_to_cr","currTurn","points","multiplier","attribute","attr","targetAbility","savingThrow","desc","curr","slot","flat","show","path","entry","App","snackbarQueue","toggleDrawer","drawerOpen","selectTab","selectedTab","dataset","tabindex","tabSelected","handleTabChange","addSnackbarMessage","message","Date","getTime","snackbarOpen","processSnackbarQueue","handleSnackbarClosed","handleSnackbarExited","snackbarMessage","load","position","onClose","onOpen","marginTop","data-tabindex","anchorOrigin","vertical","horizontal","onExited","autoHideDuration","ContentProps","id","theme","createMuiTheme","palette","primary","blue","typography","useNextVariants","document","getElementById","URL","href","origin","addEventListener","fetch","headers","response","contentType","ready","unregister","reload","checkValidServiceWorker"],"mappings":"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","file":"static/js/main.be448b47.chunk.js","sourcesContent":["// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","class API {\n\n  raw_request(url: string): Promise<any> {\n    var req = new XMLHttpRequest();\n    return new Promise((resolve, reject) => {\n      req.onreadystatechange = () => {\n        if (req.readyState !== 4) return;\n        if (req.status >= 200 && req.status < 300) {\n          resolve(JSON.parse(req.responseText));\n        } else {\n          reject({\n            status: req.status,\n            statusText: req.statusText\n          });\n        }\n      };\n      req.open('GET', url, true);\n      req.send();\n    });\n  }\n\n  async listImages(): Promise<string[]> {\n    return await this.raw_request(`http://localhost:5000/listImages`);\n  }\n\n  async searchImages(query: string): Promise<string[]> {\n    return await this.raw_request(`http://localhost:5000/searchImages?q=${encodeURIComponent(query)}`);\n  }\n\n  async downloadImage(name: string, url: string): Promise<boolean> {\n    return await this.raw_request(`http://localhost:5000/downloadImage?name=${name}&url=${encodeURIComponent(url)}`);\n  }\n\n  async listDataFiles(): Promise<string[]> {\n    return await this.raw_request(`http://localhost:5000/listDataFiles`);\n  }\n\n}\n\nexport default API;","import API from \"./API\"\n\nexport interface NameTextPair {\n  name: string\n  text: string | string[]\n}\n\nexport interface Monster {\n  name: string\n  kind: 'monster'\n  cr: string | number\n  ac: string | number\n  hp: string\n  passive: number\n  size: string\n  speed: string\n  str: number\n  dex: number\n  con: number\n  int: number\n  wis: number\n  cha: number\n  alignment: string\n  type: string\n  description?: string\n  action?: NameTextPair[] | NameTextPair\n  reaction?: NameTextPair[] | NameTextPair\n  legendary?: NameTextPair[] | NameTextPair\n  save?: string\n  trait?: NameTextPair[] | NameTextPair\n  languages?: string\n  skill?: string\n  resist?: string\n  vulnerable?: string\n  immune?: string\n  conditionImmune?: string\n  senses?: string\n  spells?: string\n  slots?: string\n  compendium: { [key: string]: any }\n  status?: Status\n}\n\nexport interface SpellSlots {\n  spells: Spell[]\n  slots: number\n}\n\nexport interface Spellcasting {\n  dc: number\n  modifier: number\n}\n\nexport interface Status {\n  hp: number\n  maxHP: number\n  initiative: number\n  x: number\n  y: number\n  damage: NameTextPair[]\n  saves: NameTextPair[]\n  actions: NameTextPair[]\n  reactions: NameTextPair[]\n  legendaries: NameTextPair[]\n  conditions: string[]\n  spellcasting?: Spellcasting\n  spellSlots: SpellSlots[]\n}\n\nexport interface Spell {\n  name: string\n  kind: 'spell'\n  level: number\n  classes: string\n  time: string\n  duration: string\n  range: string\n  components: string\n  school: string\n  text: string[] | string\n}\n\nexport interface Item {\n  name: string\n  kind: 'item'\n  range: string\n  dmg1: string\n  dmg2: string\n  dmgType: string\n  value: string\n  ac: string\n  text: string[] | string\n}\n\nexport interface Feature {\n  name: string\n  kind: 'feature'\n  text: string[] | string\n}\n\nexport interface Autolevel {\n  slots?: string\n  feature?: Feature[] | Feature\n}\n\nexport interface Class {\n  name: string\n  kind: 'class'\n  hd: string\n  proficiency: string\n  spellAbility: string\n  autolevel: Autolevel[]\n}\n\nexport interface Feat {\n  name: string\n  kind: 'feat'\n}\n\nexport interface Race {\n  name: string\n  kind: 'race'\n  trait: NameTextPair[] | NameTextPair\n  ability: string\n  size: string\n  speed: string\n}\n\nexport interface Background {\n  name: string\n  kind: 'background'\n  trait: NameTextPair[]\n  proficiency: string\n}\n\nexport type CompendiumItem = Background | Class | Feat | Item | Monster | Race | Spell;\n\nexport class Compendium {\n\n  public sources: string[] | undefined;\n  public backgrounds: { [key: string]: Background } = {}\n  public classes: { [key: string]: Class } = {}\n  public feats: { [key: string]: Feat } = {}\n  public items: { [key: string]: Item } = {}\n  public monsters: { [key: string]: Monster } = {}\n  public races: { [key: string]: Race } = {}\n  public spells: { [key: string]: Spell } = {}\n  public loaded: boolean = false;\n\n  public static abilities: string[] = [\n    \"Strength\",\n    \"Dexterity\",\n    \"Constitution\",\n    \"Intelligence\",\n    \"Wisdom\",\n    \"Charisma\"\n  ];\n\n  public static skills: { [key: string]: string } = {\n    \"Acrobatics\": \"Dexterity\",\n    \"Animal Handling\": \"Wisdom\",\n    \"Arcana\": \"Intelligence\",\n    \"Athletics\": \"Strength\",\n    \"Deception\": \"Charisma\",\n    \"History\": \"Wisdom\",\n    \"Insight\": \"Wisdom\",\n    \"Intimidation\": \"Charisma\",\n    \"Investigation\": \"Intelligence\",\n    \"Medicine\": \"Wisdom\",\n    \"Nature\": \"Intelligence\",\n    \"Perception\": \"Wisdom\",\n    \"Performance\": \"Charisma\",\n    \"Persuasion\": \"Charisma\",\n    \"Religion\": \"Intelligence\",\n    \"Slight of Hand\": \"Dexterity\",\n    \"Stealth\": \"Dexterity\",\n    \"Survival\": \"Wisdom\"\n  };\n\n  public static coinage: string[] = [\n    \"Copper\",\n    \"Silver\",\n    \"Electrum\",\n    \"Gold\",\n    \"Platinum\"\n  ];\n\n  public static hit_dice_for_class: { [key: string]: number } = {\n    \"Barbarian\": 12,\n    \"Bard\": 8,\n    \"Cleric\": 8,\n    \"Druid\": 8,\n    \"Fighter\": 10,\n    \"Monk\": 8,\n    \"Paladin\": 10,\n    \"Ranger\": 10,\n    \"Rogue\": 8,\n    \"Sorcerer\": 6,\n    \"Warlock\": 8,\n    \"Wizard\": 6\n  }\n\n  public static modifier(ability_score: number | string | undefined) {\n    if (ability_score === undefined) {\n      return NaN;\n    }\n    if (typeof (ability_score) === 'string') {\n      ability_score = parseInt(ability_score);\n    }\n    return Math.floor((ability_score - 10) / 2);\n  }\n\n  public static modifierText(bonus: number) {\n    if (isNaN(bonus)) {\n      return '';\n    }\n    if (bonus < 0) {\n      return bonus;\n    }\n    return '+' + bonus;\n  }\n\n  public static types: { [key: string]: string } = {\n    'background': 'backgrounds',\n    'class': 'classes',\n    'feat': 'feats',\n    'item': 'items',\n    'monster': 'monsters',\n    'race': 'races',\n    'spell': 'spells',\n  }\n\n  public static cr_to_xp: { [key: string]: number } = {\n    '0': 10,\n    '1/8': 25,\n    '1/4': 50,\n    '1/2': 100,\n    '1': 200,\n    '2': 450,\n    '3': 700,\n    '4': 1100,\n    '5': 1800,\n    '6': 2300,\n    '7': 2900,\n    '8': 3900,\n    '9': 5000,\n    '10': 5900,\n    '11': 7200,\n    '12': 8400,\n    '13': 10000,\n    '14': 11500,\n    '15': 13000,\n    '16': 15000,\n    '17': 18000,\n    '18': 20000,\n    '19': 22000,\n    '20': 25000,\n    '21': 33000,\n    '22': 41000,\n    '23': 50000,\n    '24': 62000,\n    '25': 75000,\n    '26': 90000,\n    '27': 105000,\n    '28': 120000,\n    '29': 135000,\n    '30': 155000,\n  }\n\n  public static xp_to_cr(xp: number): string {\n    return (Object.entries(this.cr_to_xp)\n      .sort((a, b) => a[1] - b[1])\n      .find(pair => xp <= pair[1]) || ['30+', NaN])[0];\n  }\n\n  public static encounter_difficulty: { [key: number]: number[] } = {\n    1: [25, 50, 75, 100],\n    2: [50, 100, 150, 200],\n    3: [75, 150, 225, 400],\n    4: [125, 250, 375, 500],\n    5: [250, 500, 750, 1100],\n    6: [300, 600, 900, 1400],\n    7: [350, 750, 1100, 1700],\n    8: [450, 900, 1400, 2100],\n    9: [550, 1100, 1600, 2400],\n    10: [600, 1200, 1900, 2800],\n    11: [800, 1600, 2400, 3600],\n    12: [1000, 2000, 3000, 4500],\n    13: [1100, 2200, 3400, 5100],\n    14: [1250, 2500, 3800, 5700],\n    15: [1400, 2800, 4300, 6400],\n    16: [1600, 3200, 4800, 7200],\n    17: [2000, 3900, 5900, 8800],\n    18: [2100, 4200, 6300, 9500],\n    19: [2400, 4900, 7300, 10900],\n    20: [2800, 5700, 8500, 12700],\n  }\n\n  // e.g. AC 19 (natural armor)\n  public static ac(m: Monster): number {\n    if (typeof m.ac === 'string') {\n      const match = m.ac.match(/(\\d+)/);\n      if (match !== null) {\n        return parseInt(match[1]);\n      }\n      return 10;\n    }\n    return m.ac;\n  }\n\n  public parseHP(m: Monster): { num: number, die: number, bonus: number } | undefined {\n    const match = m.hp.match(/\\d+ \\((\\d+)d(\\d+)(\\+(\\d+))?\\)/);\n    if (match) {\n      return {\n        num: parseInt(match[1]),\n        die: parseInt(match[2]),\n        bonus: parseInt(match[4])\n      };\n    }\n    return undefined;\n  }\n\n  public parseSpellcasting(m: Monster): Spellcasting | undefined {\n    let traits = m.trait;\n    if (!traits) return undefined;\n    if (!(traits instanceof Array)) traits = [traits];\n    return traits.map(trait => {\n      if (trait.name !== 'Spellcasting') return undefined;\n      let texts = trait.text;\n      if (!(texts instanceof Array)) texts = [texts];\n      for (let text of texts) {\n        const match = text.match(/spell save DC (\\d+), \\+(\\d+) to hit with spell attacks/);\n        if (!match) return undefined;\n        return { dc: parseInt(match[1]), modifier: parseInt(match[2]) };\n      }\n      return undefined;\n    }).find(spellcasting => spellcasting);\n  }\n\n  public parseSpellSlots(m: Monster): SpellSlots[] {\n    if (!m.spells) {\n      return [];\n    }\n    const spellList = m.spells.replace(/^Spells: /, '').split(',').map((spellName) => {\n      return Object.values(this.spells).find((spell) => spell.name.toLowerCase() === spellName.trim().toLowerCase());\n    }).filter((spell) => spell) as Spell[];\n    const cantrips = spellList.filter((spell: Spell) => spell.level === 0);\n    const slots = m.slots?.split(',') || [];\n    return [{\n      spells: cantrips,\n      slots: NaN,\n    }].concat(slots.map((count, index) => {\n      const spellsAtThisLevel = spellList.filter((spell: Spell) => {\n        return spell.level === index + 1;\n      });\n      return {\n        spells: spellsAtThisLevel,\n        slots: parseInt(count)\n      }\n    }));\n  }\n\n  async load() {\n    this.sources = [\n      'Backgrounds 1.6.0.json',\n      'Bestiary Compendium 2.1.0.json',\n      'Character Compendium 3.1.0.json',\n      'Classes 3.1.1.json',\n      'Curse of Strahd Bestiary 1.2.0.json',\n      'EE Spells 2.6.json',\n      'Feats 1.4.1.json',\n      'Futuristic Items 1.2.json',\n      'Hoard of the Dragon Queen Bestiary 1.3.0.json',\n      'Items Compendium 1.7.0.json',\n      'Magic Items 5.3.json',\n      'Modern Items 1.2.json',\n      'Modern Spells 1.1.json',\n      'Monster Manual Bestiary 2.6.0.json',\n      'Mundane Items 2.8.0.json',\n      'Out of the Abyss 1.4.0.json',\n      'PHB Spells 3.9.0.json',\n      'Phandelver Bestiary 1.3.0.json',\n      'Princes of the Apocalypse Bestiary 1.3.0.json',\n      'Races 2.0.json',\n      'Renaissance Items 1.3.json',\n      'SCAG Spells 1.2.json',\n      'Spells Compendium 1.3.0.json',\n      'Storm King_s Thunder Bestiary 1.1.0.json',\n      'The Rise of Tiamat Bestiary 1.3.0.json',\n      'UA_Demon Summoning 1.0.json',\n      'UA_Races 1.0.1.json',\n      'Valuable Items 1.3.json',\n      'Volo_s Bestiary 1.1.0.json',\n    ];\n    await Promise.all(this.sources.map(async (source: string) => {\n      const sourceData = await new API().raw_request(`${process.env.PUBLIC_URL}/data/${source}`);\n      this.loadData(source, sourceData);\n    }));\n    (window as any).compendium = this;\n    this.loaded = true;\n  }\n\n  loadData(source: string, sourceData: any) {\n    Object.entries(Compendium.types).forEach(([objType, attrName]) => {\n      if (sourceData.hasOwnProperty(objType)) {\n        Object.values(sourceData[objType]).forEach((obj: any) => {\n          if (obj.name) {\n            obj['source'] = source;\n            obj['kind'] = objType.slice(0, objType.length);\n            (this as any)[attrName][obj.name] = obj;\n          }\n        });\n      }\n    });\n  }\n\n}\n\nexport default Compendium","import * as React from 'react';\r\nimport { createStyles, WithStyles, withStyles } from '@material-ui/core/styles';\r\n\r\nimport Button from '@material-ui/core/Button';\r\nimport Card from '@material-ui/core/Card';\r\nimport CardActions from '@material-ui/core/CardActions';\r\nimport CardContent from '@material-ui/core/CardContent';\r\nimport Close from 'mdi-material-ui/Close';\r\nimport IconButton from '@material-ui/core/IconButton';\r\nimport Typography from '@material-ui/core/Typography';\r\n\r\nimport { Spell } from '../Compendium';\r\n\r\nexport interface Props extends WithStyles<typeof styles> {\r\n  spell: Spell\r\n  handleCloseClicked?: (event: React.MouseEvent) => void\r\n}\r\n\r\nconst styles = createStyles({\r\n  card: {\r\n    width: 400,\r\n    margin: '10px 20px',\r\n    overflowY: 'auto',\r\n  },\r\n  media: {\r\n    height: 140,\r\n    backgroundPosition: 'center',\r\n  },\r\n  action: {\r\n    display: 'flex',\r\n    flexDirection: 'column',\r\n  },\r\n  actionName: {\r\n    fontWeight: 600,\r\n  },\r\n  h5InputParent: {\r\n    width: '100%',\r\n    marginBottom: '10px',\r\n  },\r\n  h5Input: {\r\n    width: '100%',\r\n    color: 'rgba(0, 0, 0, 0.87)',\r\n    fontSize: '1.5rem',\r\n    fontWeight: 400,\r\n    lineHeight: '1.33',\r\n    letterSpacing: '0em',\r\n    paddingTop: '3px',\r\n    marginBottom: '2.4px',\r\n    padding: '0',\r\n  },\r\n  table: {\r\n    textAlign: 'center',\r\n  },\r\n  numberInputParent: {\r\n    maxWidth: '2em',\r\n    alignSelf: 'center',\r\n  },\r\n  titleRow: {\r\n    display: 'flex',\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'space-between',\r\n    marginBottom: '8px',\r\n  },\r\n});\r\n\r\nclass SpellCard extends React.Component<Props> {\r\n\r\n  private renderText(text: string[] | string) {\r\n    if (!(text instanceof Array)) {\r\n      text = [text];\r\n    }\r\n    return text.map((line, i) => <Typography key={i}>{line}</Typography>);\r\n  }\r\n\r\n  public render() {\r\n    const { classes, spell, handleCloseClicked } = this.props;\r\n    return <Card className={classes.card}>\r\n      <CardContent>\r\n        <div className={classes.titleRow}>\r\n          <Typography variant=\"h5\">{spell.name}</Typography>\r\n          {handleCloseClicked && <IconButton onClick={handleCloseClicked}><Close /></IconButton>}\r\n        </div>\r\n        <Typography>Level: {spell.level}</Typography>\r\n        <Typography>Classes: {spell.classes}</Typography>\r\n        <Typography>Time: {spell.time}</Typography>\r\n        <Typography>Duration: {spell.duration}</Typography>\r\n        <Typography>Range: {spell.range}</Typography>\r\n        <Typography>Components: {spell.components}</Typography>\r\n        <Typography>School: {spell.school}</Typography>\r\n        {this.renderText(spell.text)}\r\n      </CardContent>\r\n      <CardActions>\r\n        <Button color=\"primary\">Add To Character</Button>\r\n      </CardActions>\r\n    </Card>\r\n  }\r\n}\r\n\r\nexport default withStyles(styles)(SpellCard);\r\n","import * as React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport { ArrowKeyStepper, AutoSizer, Table, ScrollIndices, SortDirection, SortDirectionType } from 'react-virtualized';\r\nimport { createStyles, WithStyles, withStyles } from '@material-ui/core/styles';\r\n\r\nimport TextField from '@material-ui/core/TextField';\r\n\r\nexport interface Props extends WithStyles<typeof styles> {\r\n  name: string\r\n  compare: (sortBy: string, sortDirection: SortDirectionType) => (a: any, b: any) => number\r\n  renderItemCard: (item: any, handleCloseClicked: (event: React.MouseEvent) => void) => JSX.Element\r\n  items: { [key: string]: any }\r\n}\r\n\r\ninterface State {\r\n  query: string,\r\n  sortBy?: string,\r\n  sortDirection?: SortDirectionType,\r\n  scrollToRow?: number,\r\n  selectedItemIndex?: number,\r\n}\r\n\r\nconst styles = createStyles({\r\n  container: {\r\n    display: 'flex',\r\n    flexDirection: 'column',\r\n    flex: '1',\r\n  },\r\n  tableWithCard: {\r\n    display: 'flex',\r\n    flex: '1',\r\n    marginBottom: '20px',\r\n  },\r\n  table: {\r\n    flex: '1',\r\n    overflow: 'hidden',\r\n  },\r\n  highlight: {\r\n    boxSizing: 'border-box',\r\n    borderBottom: '1px solid #e0e0e0',\r\n    cursor: 'pointer',\r\n    backgroundColor: '#a9e7ff'\r\n  },\r\n  row: {\r\n    boxSizing: 'border-box',\r\n    borderBottom: '1px solid #e0e0e0',\r\n    cursor: 'pointer',\r\n  },\r\n  odd: {\r\n    boxSizing: 'border-box',\r\n    borderBottom: '1px solid #e0e0e0',\r\n    backgroundColor: '#fafafa',\r\n    cursor: 'pointer',\r\n  },\r\n});\r\n\r\nclass TableWithCard extends React.Component<Props, State> {\r\n\r\n  public constructor(props: Props) {\r\n    super(props);\r\n    this.state = {\r\n      query: '',\r\n    };\r\n  }\r\n\r\n  private handleSearchChanged = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n    this.setState({\r\n      query: event.currentTarget.value,\r\n    });\r\n  }\r\n\r\n  private handleRowClick = ({ event, index, rowData }: { event: React.MouseEvent<any>, index: number, rowData: any }) => {\r\n    this.setState({ selectedItemIndex: index, scrollToRow: index });\r\n  }\r\n\r\n  private handleCloseClicked = (event: React.MouseEvent<any>) => {\r\n    this.setState({ selectedItemIndex: undefined });\r\n  }\r\n\r\n  private onScrollToChange = (params: ScrollIndices) => {\r\n    if (this.tableRef.current !== null) {\r\n      const node = ReactDOM.findDOMNode(this.tableRef.current.Grid)\r\n      if (node instanceof HTMLElement) node.focus();\r\n    }\r\n    this.setState({ scrollToRow: params.scrollToRow });\r\n  }\r\n\r\n  private sort = ({ sortBy, sortDirection }: { sortBy?: string, sortDirection?: SortDirectionType }) => {\r\n    const {\r\n      sortDirection: prevSortDirection\r\n    } = this.state;\r\n\r\n    // If list was sorted DESC by this column.\r\n    // Rather than switch to ASC, return to \"natural\" order.\r\n    if (prevSortDirection === SortDirection.DESC) {\r\n      sortBy = undefined;\r\n      sortDirection = undefined;\r\n    }\r\n\r\n    this.setState({ sortBy, sortDirection });\r\n  }\r\n\r\n  private tableRef = React.createRef<Table>();\r\n\r\n  public render() {\r\n    const { classes, name, compare, renderItemCard, items, children } = this.props;\r\n    const { query, sortBy, sortDirection, scrollToRow, selectedItemIndex } = this.state;\r\n    const list = Object.values(items).filter((obj) => query === '' || obj.name.toLowerCase().includes(query.toLowerCase()));\r\n    list.sort(compare(sortBy || 'name', sortDirection || SortDirection.ASC));\r\n    return <div className={classes.container}>\r\n      <TextField\r\n        label={`Search ${name}`}\r\n        type=\"search\"\r\n        margin=\"normal\"\r\n        value={this.state.query}\r\n        onChange={this.handleSearchChanged} />\r\n      <div className={classes.tableWithCard}>\r\n        <div className={classes.table}>\r\n          <AutoSizer>\r\n            {({ height, width }) => (\r\n              <ArrowKeyStepper\r\n                isControlled={true}\r\n                onScrollToChange={this.onScrollToChange}\r\n                columnCount={1}\r\n                mode=\"cells\"\r\n                rowCount={list.length}\r\n                scrollToRow={scrollToRow}>\r\n                {({ onSectionRendered, scrollToColumn, scrollToRow }: { onSectionRendered: any, scrollToColumn: number, scrollToRow: number }) => (\r\n                  <Table\r\n                    ref={this.tableRef}\r\n                    headerHeight={30}\r\n                    height={height}\r\n                    rowClassName={({ index }: { index: number }) => (scrollToRow === index ? classes.highlight : index % 2 === 0 ? classes.row : classes.odd)}\r\n                    noRowsRenderer={() => <div>No rows</div>}\r\n                    rowHeight={80}\r\n                    rowGetter={({ index }: { index: number }) => list[index]}\r\n                    rowCount={list.length}\r\n                    onSectionRendered={onSectionRendered}\r\n                    scrollToIndex={scrollToRow}\r\n                    onRowClick={this.handleRowClick}\r\n                    width={width}\r\n                    sort={this.sort}\r\n                    sortBy={sortBy}\r\n                    sortDirection={sortDirection}>\r\n                    {children}\r\n                  </Table>\r\n                )}\r\n              </ArrowKeyStepper>\r\n            )}\r\n          </AutoSizer>\r\n        </div>\r\n        {selectedItemIndex !== undefined && selectedItemIndex < list.length && renderItemCard(list[selectedItemIndex], this.handleCloseClicked)}\r\n      </div>\r\n    </div>;\r\n  }\r\n}\r\n\r\nexport default withStyles(styles)(TableWithCard);\r\n","import * as React from 'react';\r\nimport { Column, SortDirection, SortDirectionType } from 'react-virtualized';\r\n\r\nimport { Spell } from '../Compendium';\r\nimport SpellCard from '../cards/SpellCard';\r\nimport TableWithCard from '../TableWithCard';\r\n\r\nexport interface Props {\r\n  spells: { [key: string]: Spell }\r\n}\r\n\r\nexport default class SpellsTab extends React.Component<Props> {\r\n\r\n  private compare = (sortBy: string, sortDirection: SortDirectionType) => {\r\n    return (a: any, b: any) => {\r\n      const direction = sortDirection === SortDirection.ASC ? 1 : -1;\r\n      return (a[sortBy] || '').toString().toLowerCase() <= (b[sortBy] || '').toString().toLowerCase() ? -direction : direction;\r\n    };\r\n  }\r\n\r\n  public render() {\r\n    const { spells } = this.props;\r\n    return <TableWithCard\r\n      name=\"Spells\"\r\n      items={spells}\r\n      compare={this.compare}\r\n      renderItemCard={(spell: Spell, handleCloseClicked: (event: React.MouseEvent) => void) => <SpellCard spell={spell} handleCloseClicked={handleCloseClicked} />}>\r\n      <Column\r\n        label=\"name\"\r\n        dataKey=\"name\"\r\n        width={250} />\r\n      <Column\r\n        label=\"level\"\r\n        dataKey=\"level\"\r\n        width={70} />\r\n      <Column\r\n        label=\"classes\"\r\n        dataKey=\"classes\"\r\n        className=\"wrap\"\r\n        flexGrow={1}\r\n        width={0} />\r\n      <Column\r\n        label=\"school\"\r\n        dataKey=\"school\"\r\n        className=\"wrap\"\r\n        flexGrow={1}\r\n        width={0} />\r\n      <Column\r\n        label=\"duration\"\r\n        dataKey=\"duration\"\r\n        className=\"wrap\"\r\n        flexGrow={1}\r\n        width={0} />\r\n      <Column\r\n        label=\"time\"\r\n        dataKey=\"time\"\r\n        className=\"wrap\"\r\n        flexGrow={1}\r\n        width={0} />\r\n    </TableWithCard>\r\n  }\r\n}\r\n","import * as React from 'react';\r\nimport { createStyles, WithStyles, withStyles } from '@material-ui/core/styles';\r\n\r\nimport Button from '@material-ui/core/Button';\r\nimport Card from '@material-ui/core/Card';\r\nimport CardActions from '@material-ui/core/CardActions';\r\nimport CardContent from '@material-ui/core/CardContent';\r\nimport Close from 'mdi-material-ui/Close';\r\nimport IconButton from '@material-ui/core/IconButton';\r\nimport Typography from '@material-ui/core/Typography';\r\n\r\nimport { Item } from '../Compendium';\r\n\r\nexport interface Props extends WithStyles<typeof styles> {\r\n  item: Item\r\n  handleCloseClicked?: (event: React.MouseEvent) => void\r\n}\r\n\r\nconst styles = createStyles({\r\n  card: {\r\n    width: 400,\r\n    margin: '10px 20px',\r\n    overflowY: 'auto',\r\n  },\r\n  media: {\r\n    height: 140,\r\n    backgroundPosition: 'center',\r\n  },\r\n  action: {\r\n    display: 'flex',\r\n    flexDirection: 'column',\r\n  },\r\n  actionName: {\r\n    fontWeight: 600,\r\n  },\r\n  h5InputParent: {\r\n    width: '100%',\r\n    marginBottom: '10px',\r\n  },\r\n  h5Input: {\r\n    width: '100%',\r\n    color: 'rgba(0, 0, 0, 0.87)',\r\n    fontSize: '1.5rem',\r\n    fontWeight: 400,\r\n    lineHeight: '1.33',\r\n    letterSpacing: '0em',\r\n    paddingTop: '3px',\r\n    marginBottom: '2.4px',\r\n    padding: '0',\r\n  },\r\n  table: {\r\n    textAlign: 'center',\r\n  },\r\n  numberInputParent: {\r\n    maxWidth: '2em',\r\n    alignSelf: 'center',\r\n  },\r\n  titleRow: {\r\n    display: 'flex',\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'space-between',\r\n    marginBottom: '8px',\r\n  },\r\n});\r\n\r\nclass ItemCard extends React.Component<Props> {\r\n\r\n  private renderText(text: string[] | string) {\r\n    if (!(text instanceof Array)) {\r\n      text = [text];\r\n    }\r\n    return text.map((line, i) => <Typography key={i}>{line}</Typography>);\r\n  }\r\n\r\n  public render() {\r\n    const { classes, item, handleCloseClicked } = this.props;\r\n    return <Card className={classes.card}>\r\n      <CardContent>\r\n        <div className={classes.titleRow}>\r\n          <Typography variant=\"h5\">{item.name}</Typography>\r\n          {handleCloseClicked && <IconButton onClick={handleCloseClicked}><Close /></IconButton>}\r\n        </div>\r\n        <Typography>Range: {item.range}</Typography>\r\n        <Typography>Damage: {item.dmg1}</Typography>\r\n        <Typography>Type: {item.dmgType}</Typography>\r\n        <Typography>Value: {item.value}</Typography>\r\n        <Typography>AC: {item.ac}</Typography>\r\n        {this.renderText(item.text)}\r\n      </CardContent>\r\n      <CardActions>\r\n        <Button color=\"primary\">Add To Character</Button>\r\n      </CardActions>\r\n    </Card>\r\n  }\r\n}\r\n\r\nexport default withStyles(styles)(ItemCard);\r\n","import * as React from 'react';\r\nimport { Column, SortDirection, SortDirectionType } from 'react-virtualized';\r\n\r\nimport { Item } from '../Compendium';\r\nimport ItemCard from '../cards/ItemCard';\r\nimport TableWithCard from '../TableWithCard';\r\n\r\nexport interface Props {\r\n  items: { [key: string]: Item }\r\n}\r\n\r\nexport default class ItemsTab extends React.Component<Props> {\r\n\r\n  private parseValue = (value: string): number => {\r\n    if (value.includes('cp')) {\r\n      return parseInt(value.split('cp')[0]) / 100;\r\n    }\r\n    if (value.includes('sp')) {\r\n      return parseInt(value.split('sp')[0]) / 10;\r\n    }\r\n    if (value.includes('ep')) {\r\n      return parseInt(value.split('ep')[0]) / 2;\r\n    }\r\n    if (value.includes('gp')) {\r\n      return parseInt(value.split('gp')[0]);\r\n    }\r\n    if (value.includes('pp')) {\r\n      return 10 * parseInt(value.split('pp')[0]);\r\n    }\r\n    return NaN;\r\n  }\r\n\r\n  private compare = (sortBy: string, sortDirection: SortDirectionType) => {\r\n    return (a: any, b: any) => {\r\n      const direction = sortDirection === SortDirection.ASC ? 1 : -1;\r\n      if (sortBy === 'value') {\r\n        const aValue = this.parseValue(a.value || '0gp');\r\n        const bValue = this.parseValue(b.value || '0gp');\r\n        return aValue <= bValue ? -direction : direction;\r\n      }\r\n      return (a[sortBy] || '').toString().toLowerCase() <= (b[sortBy] || '').toString().toLowerCase() ? -direction : direction;\r\n    };\r\n  }\r\n\r\n  private renderItemCard = (item: Item, handleCloseClicked: (event: React.MouseEvent) => void) => {\r\n    return <ItemCard item={item} handleCloseClicked={handleCloseClicked} />\r\n  }\r\n\r\n  public render() {\r\n    const { items } = this.props;\r\n    return <TableWithCard\r\n      name=\"Items\"\r\n      items={items}\r\n      renderItemCard={this.renderItemCard}\r\n      compare={this.compare}>\r\n      <Column\r\n        label=\"name\"\r\n        dataKey=\"name\"\r\n        width={250} />\r\n      <Column\r\n        label=\"range\"\r\n        dataKey=\"range\"\r\n        flexGrow={1}\r\n        className=\"wrap\"\r\n        width={0} />\r\n      <Column\r\n        label=\"damage\"\r\n        dataKey=\"dmg1\"\r\n        flexGrow={1}\r\n        className=\"wrap\"\r\n        width={0} />\r\n      <Column\r\n        label=\"type\"\r\n        dataKey=\"dmgType\"\r\n        flexGrow={1}\r\n        className=\"wrap\"\r\n        width={0} />\r\n      <Column\r\n        label=\"value\"\r\n        dataKey=\"value\"\r\n        flexGrow={1}\r\n        className=\"wrap\"\r\n        width={0} />\r\n      <Column\r\n        label=\"ac\"\r\n        dataKey=\"ac\"\r\n        flexGrow={1}\r\n        className=\"wrap\"\r\n        width={0} />\r\n    </TableWithCard>\r\n  }\r\n}\r\n","import * as React from 'react';\r\nimport { createStyles, WithStyles, withStyles } from '@material-ui/core/styles';\r\nimport classNames from 'classnames';\r\n\r\nimport Card from '@material-ui/core/Card';\r\nimport CardContent from '@material-ui/core/CardContent';\r\nimport Close from 'mdi-material-ui/Close';\r\nimport IconButton from '@material-ui/core/IconButton';\r\nimport TextField from '@material-ui/core/TextField';\r\nimport Typography from '@material-ui/core/Typography';\r\n\r\nimport { Compendium, Monster, NameTextPair } from '../Compendium';\r\n\r\nconst styles = createStyles({\r\n  card: {\r\n    width: 400,\r\n    margin: '10px 20px',\r\n    overflowY: 'auto',\r\n  },\r\n  media: {\r\n    height: 140,\r\n    backgroundPosition: 'center',\r\n  },\r\n  action: {\r\n    display: 'flex',\r\n    flexDirection: 'column',\r\n  },\r\n  actionName: {\r\n    fontWeight: 600,\r\n  },\r\n  h5InputParent: {\r\n    width: '100%',\r\n    marginBottom: '10px',\r\n  },\r\n  h5Input: {\r\n    width: '100%',\r\n    color: 'rgba(0, 0, 0, 0.87)',\r\n    fontSize: '1.5rem',\r\n    fontWeight: 400,\r\n    lineHeight: '1.33',\r\n    letterSpacing: '0em',\r\n    paddingTop: '3px',\r\n    marginBottom: '2.4px',\r\n    padding: '0',\r\n  },\r\n  table: {\r\n    textAlign: 'center',\r\n  },\r\n  numberInputParent: {\r\n    maxWidth: '2em',\r\n    alignSelf: 'center',\r\n  },\r\n  iconButton: {\r\n    padding: 0,\r\n  },\r\n  titleRow: {\r\n    display: 'flex',\r\n    flexDirection: 'row',\r\n    alignItems: 'center',\r\n    justifyContent: 'space-between',\r\n    marginBottom: '8px',\r\n  },\r\n});\r\n\r\nexport interface Props {\r\n  monster: Monster\r\n  handleCloseClicked?: (event: React.MouseEvent) => void\r\n}\r\n\r\ninterface StyledProps extends Props, WithStyles<typeof styles> { }\r\n\r\nclass MonsterCard extends React.Component<StyledProps> {\r\n\r\n  inputRef = React.createRef<HTMLInputElement>();\r\n\r\n  private renderAction = (action: NameTextPair, i: number) => {\r\n    return <span key={`action-${i}`}>\r\n      <span className={this.props.classes.actionName}>{action.name}</span>: {action.text}\r\n    </span>;\r\n  }\r\n\r\n  private renderActions = (actions: NameTextPair[] | NameTextPair | undefined) => {\r\n    if (!actions) {\r\n      return null;\r\n    }\r\n    if (!(actions instanceof Array)) {\r\n      actions = [actions];\r\n    }\r\n    const content = actions.map(this.renderAction)\r\n    return <div className={this.props.classes.action}>\r\n      {content}\r\n    </div>;\r\n  }\r\n\r\n  private renderSpellSlots = (slots: string) => {\r\n    return slots.split(',').map((v, i) => {\r\n      const count = parseInt(v);\r\n      if (count > 0) {\r\n        return <TextField\r\n          key={i}\r\n          value={count}\r\n          type=\"number\"\r\n        />;\r\n      }\r\n      return null;\r\n    }).filter((c) => c != null);\r\n  }\r\n\r\n  public render() {\r\n    const { classes, monster, handleCloseClicked } = this.props;\r\n    const {\r\n      name,\r\n      cr, ac, hp, passive,\r\n      size, speed,\r\n      str, dex, con, int, wis, cha,\r\n      skill,\r\n      senses,\r\n      alignment,\r\n      languages,\r\n      type,\r\n      description,\r\n      action, reaction, legendary,\r\n      trait,\r\n      save,\r\n      resist, vulnerable, immune, conditionImmune,\r\n      spells, slots,\r\n    } = monster;\r\n    const actions = this.renderActions(action);\r\n    const reactions = this.renderActions(reaction);\r\n    const legendaryActions = this.renderActions(legendary);\r\n    const traits = this.renderActions(trait);\r\n    const spellSlots = slots ? this.renderSpellSlots(slots) : null;\r\n    return <Card className={classes.card}>\r\n      <CardContent>\r\n        <div className={classes.titleRow}>\r\n          <Typography variant=\"h5\">{name}</Typography>\r\n          {handleCloseClicked && <IconButton onClick={handleCloseClicked}><Close /></IconButton>}\r\n        </div>\r\n        <div className=\"row justify-content-space-around\">\r\n          <table className={classNames(\"flex-1\", classes.table)}>\r\n            <thead>\r\n              <tr>\r\n                <th>CR</th>\r\n                <th>XP</th>\r\n                <th>AC</th>\r\n                <th>HP</th>\r\n                <th>Passive</th>\r\n                <th>Size</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              <tr>\r\n                <td>{cr}</td>\r\n                <td>{Compendium.cr_to_xp[cr]}</td>\r\n                <td>{(typeof (ac) === 'string') ? ac.split(' ')[0] : ac}</td>\r\n                <td>{(typeof (hp) === 'string') ? hp.split(' ')[0] : hp}</td>\r\n                <td>{passive}</td>\r\n                <td>{size}</td>\r\n              </tr>\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n        <div className=\"row\">\r\n          <table className={classNames(\"flex-1\", classes.table)}>\r\n            <thead>\r\n              <tr>\r\n                <th>Str</th>\r\n                <th>Dex</th>\r\n                <th>Con</th>\r\n                <th>Int</th>\r\n                <th>Wis</th>\r\n                <th>Cha</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              <tr>\r\n                <td>{Compendium.modifierText(Compendium.modifier(str))}</td>\r\n                <td>{Compendium.modifierText(Compendium.modifier(dex))}</td>\r\n                <td>{Compendium.modifierText(Compendium.modifier(con))}</td>\r\n                <td>{Compendium.modifierText(Compendium.modifier(int))}</td>\r\n                <td>{Compendium.modifierText(Compendium.modifier(wis))}</td>\r\n                <td>{Compendium.modifierText(Compendium.modifier(cha))}</td>\r\n              </tr>\r\n              <tr>\r\n                <td>{str}</td>\r\n                <td>{dex}</td>\r\n                <td>{con}</td>\r\n                <td>{int}</td>\r\n                <td>{wis}</td>\r\n                <td>{cha}</td>\r\n              </tr>\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n        <Typography>Speed: {speed}</Typography>\r\n        <Typography>Skills: {skill}</Typography>\r\n        <Typography>Senses: {senses}</Typography>\r\n        <Typography>Languages: {languages}</Typography>\r\n        <Typography>Alignment: {alignment}</Typography>\r\n        <Typography>Type: {type}</Typography>\r\n        {description && <Typography>{description}</Typography>}\r\n        {actions && <div>\r\n          <Typography gutterBottom variant=\"h6\">Actions</Typography>\r\n          {actions}\r\n        </div>}\r\n        {reactions && <div>\r\n          <Typography gutterBottom variant=\"h6\">Reactions</Typography>\r\n          {reactions}\r\n        </div>}\r\n        {legendaryActions && <div>\r\n          <Typography gutterBottom variant=\"h6\">Legendary Actions</Typography>\r\n          {legendaryActions}\r\n        </div>}\r\n        {traits && <div>\r\n          <Typography gutterBottom variant=\"h6\">Traits</Typography>\r\n          {traits}\r\n        </div>}\r\n        {save && <Typography>Save: {save}</Typography>}\r\n        {resist && <Typography>Resist: {resist}</Typography>}\r\n        {vulnerable && <Typography>Vulnerable: {vulnerable}</Typography>}\r\n        {immune && <Typography>Immune: {immune}</Typography>}\r\n        {conditionImmune && <Typography>Condition Immunities: {conditionImmune}</Typography>}\r\n        {spells && <Typography>Spells: {spells}</Typography>}\r\n        <div>\r\n          {spellSlots}\r\n        </div>\r\n      </CardContent>\r\n    </Card>\r\n  }\r\n}\r\n\r\nexport default withStyles(styles)(MonsterCard);","import * as React from 'react';\r\nimport { Column, SortDirection, SortDirectionType, TableCellDataGetterParams } from 'react-virtualized';\r\n\r\nimport { Compendium, Monster } from '../Compendium';\r\nimport TableWithCard from '../TableWithCard';\r\nimport MonsterCard from '../cards/MonsterCard';\r\n\r\nexport interface Props {\r\n  monsters: { [key: string]: Monster }\r\n}\r\n\r\nexport default class MonstersTab extends React.Component<Props> {\r\n\r\n  private firstNumber = (p: TableCellDataGetterParams) => {\r\n    const v = p.rowData[p.dataKey];\r\n    return (typeof (v) === 'string') ? v.split(' ')[0] : v;\r\n  }\r\n\r\n  private parseFirst = (value: string): number => {\r\n    return (typeof (value) === 'string') ? parseInt(value.split(' ')[0]) : value;\r\n  }\r\n\r\n  private compare = (sortBy: string, sortDirection: SortDirectionType) => {\r\n    return (a: any, b: any) => {\r\n      const direction = sortDirection === SortDirection.ASC ? 1 : -1;\r\n      if (sortBy === 'hp' || sortBy === 'ac' || sortBy === 'cr' || sortBy === 'passive') {\r\n        const aValue = this.parseFirst(a[sortBy] || '0');\r\n        const bValue = this.parseFirst(b[sortBy] || '0');\r\n        return aValue <= bValue ? -direction : direction;\r\n      }\r\n      return (a[sortBy] || '').toString().toLowerCase() <= (b[sortBy] || '').toString().toLowerCase() ? -direction : direction;\r\n    };\r\n  }\r\n\r\n  public render() {\r\n    const { monsters } = this.props;\r\n    return <TableWithCard\r\n      name=\"Monsters\"\r\n      items={monsters}\r\n      compare={this.compare}\r\n      renderItemCard={(monster: Monster, handleCloseClicked: (event: React.MouseEvent) => void) => <MonsterCard monster={monster} handleCloseClicked={handleCloseClicked} />}>\r\n      <Column\r\n        label=\"name\"\r\n        dataKey=\"name\"\r\n        width={250} />\r\n      <Column\r\n        label=\"cr\"\r\n        dataKey=\"cr\"\r\n        flexGrow={1}\r\n        width={0} />\r\n      <Column\r\n        label=\"xp\"\r\n        dataKey=\"xp\"\r\n        cellDataGetter={(p: TableCellDataGetterParams) => Compendium.cr_to_xp[p.rowData[p.dataKey]]}\r\n        flexGrow={1}\r\n        width={0} />\r\n      <Column\r\n        label=\"hp\"\r\n        dataKey=\"hp\"\r\n        cellDataGetter={this.firstNumber}\r\n        flexGrow={1}\r\n        width={0} />\r\n      <Column\r\n        label=\"ac\"\r\n        dataKey=\"ac\"\r\n        className=\"wrap\"\r\n        cellDataGetter={this.firstNumber}\r\n        flexGrow={1}\r\n        width={0} />\r\n      <Column\r\n        label=\"size\"\r\n        dataKey=\"size\"\r\n        flexGrow={1}\r\n        width={0} />\r\n      <Column\r\n        label=\"passive\"\r\n        dataKey=\"passive\"\r\n        flexGrow={1}\r\n        width={0} />\r\n      <Column\r\n        label=\"skill\"\r\n        dataKey=\"skill\"\r\n        className=\"wrap\"\r\n        flexGrow={1}\r\n        width={0} />\r\n      <Column\r\n        label=\"save\"\r\n        dataKey=\"save\"\r\n        className=\"wrap\"\r\n        flexGrow={1}\r\n        width={0} />\r\n    </TableWithCard>\r\n  }\r\n}\r\n","import * as React from 'react';\r\nimport { createStyles, WithStyles, withStyles } from '@material-ui/core/styles';\r\n\r\nimport TextField from '@material-ui/core/TextField';\r\n\r\nexport interface Props extends WithStyles<typeof styles> {\r\n  items: { [key: string]: any }\r\n  renderItem: (item: any, index: number) => JSX.Element\r\n}\r\n\r\ninterface State {\r\n  query: string,\r\n}\r\n\r\nconst styles = createStyles({\r\n  container: {\r\n    display: 'flex',\r\n    flexDirection: 'column',\r\n    flex: '1',\r\n  },\r\n  list: {\r\n    display: 'flex',\r\n    flexDirection: 'column',\r\n    flex: '1',\r\n    marginBottom: '20px',\r\n  },\r\n});\r\n\r\nclass SearchableList extends React.Component<Props, State> {\r\n\r\n  public constructor(props: Props) {\r\n    super(props);\r\n    this.state = {\r\n      query: '',\r\n    };\r\n  }\r\n\r\n  private handleSearchChanged = (event: React.ChangeEvent<HTMLInputElement>) => {\r\n    this.setState({\r\n      query: event.currentTarget.value,\r\n    });\r\n  }\r\n\r\n  public render() {\r\n    const { classes, items, renderItem } = this.props;\r\n    const { query } = this.state;\r\n    const list = Object.values(items).filter((obj) => query === '' || obj.name.toLowerCase().includes(query.toLowerCase()));\r\n    return <div className={classes.container}>\r\n      <TextField\r\n        label=\"Search\"\r\n        type=\"search\"\r\n        margin=\"normal\"\r\n        value={this.state.query}\r\n        onChange={this.handleSearchChanged} />\r\n      <div className={classes.list}>\r\n        {list.map(renderItem)}\r\n      </div>\r\n    </div>;\r\n  }\r\n}\r\n\r\nexport default withStyles(styles)(SearchableList);\n","import * as React from 'react';\r\n\r\nimport { Background } from '../Compendium';\r\nimport SearchableList from '../SearchableList';\r\n\r\nexport interface Props {\r\n  backgrounds: { [key: string]: Background }\r\n}\r\n\r\nexport default class BackgroundsTab extends React.Component<Props> {\r\n\r\n  private renderBackground = (background: any, index: number): JSX.Element => {\r\n    const content: JSX.Element[] = [];\r\n    const traits = background.trait;\r\n    traits.forEach((trait: any) => {\r\n      let text = trait.text;\r\n      if (!(trait.text instanceof Array)) {\r\n        text = [trait.text];\r\n      }\r\n      content.push(\r\n        <p key={content.length}><span className=\"term\">{trait.name}:</span>&nbsp;{(text as string[]).map((t, j) => <span key={j}>{t}<br /></span>)}</p>)\r\n    });\r\n    return <div key={index}>\r\n      <h2>{background.name}</h2>\r\n      <p><span className=\"term\">Proficiency:</span> {background.proficiency}</p>\r\n      {content}\r\n    </div>;\r\n  }\r\n\r\n  public render() {\r\n    const { backgrounds } = this.props;\r\n    return <SearchableList\r\n      items={backgrounds}\r\n      renderItem={this.renderBackground}\r\n    />;\r\n  }\r\n}\r\n","import * as React from 'react';\r\n\r\nimport Button from '@material-ui/core/Button';\r\nimport SearchableList from '../SearchableList';\r\n\r\nexport interface Props {\r\n  feats: { [key: string]: any }\r\n}\r\n\r\nexport default class FeatsTab extends React.Component<Props> {\r\n\r\n  private renderFeat = (feat: any, index: number): JSX.Element => {\r\n    let text = feat.text;\r\n    if (!(text instanceof Array)) {\r\n      text = [text];\r\n    }\r\n    return <div key={index}>\r\n      <h2>{feat.name}</h2>\r\n      <p><span className=\"term\">Modifier: {feat.modifier}</span></p>\r\n      <p>\r\n        {(text as string[]).map((t, j) => <span key={j}>{t}<br /></span>)}\r\n      </p>\r\n      <Button color=\"primary\">Add To Character</Button>\r\n    </div>;\r\n  }\r\n\r\n  public render() {\r\n    const { feats } = this.props;\r\n    return <SearchableList\r\n      items={feats}\r\n      renderItem={this.renderFeat}\r\n    />;\r\n  }\r\n}\r\n","import * as React from 'react';\n\nimport { Class, Autolevel } from '../Compendium';\n\nimport Typography from '@material-ui/core/Typography';\n\nexport interface Props {\n  clazz: Class\n}\n\nclass ClassCard extends React.Component<Props> {\n\n  public render() {\n    const { clazz } = this.props;\n    const content: JSX.Element[] = [];\n    const autolevel = clazz.autolevel;\n    autolevel.filter((level: Autolevel) => level.feature).forEach((level: Autolevel) => {\n      let features = level.feature || [];\n      if (!(features instanceof Array)) {\n        features = [features];\n      }\n      features.forEach(feature => {\n        let text = feature.text;\n        if (!(feature.text instanceof Array)) {\n          text = [feature.text];\n        }\n        const textNodes = (text as string[]).map((t, j) => <span key={j}>{t}<br /></span>);\n        content.push(\n          <Typography key={content.length}>\n            <span className=\"term\">{feature.name}:</span>&nbsp;{textNodes}\n          </Typography>\n        );\n      });\n    });\n    return <div>\n      <h2>{clazz.name}</h2>\n      <Typography><span className=\"term\">Hit Die: {clazz.hd}</span></Typography>\n      <Typography><span className=\"term\">Proficiency: {clazz.proficiency}</span></Typography>\n      <Typography>{clazz.spellAbility && <span><span className=\"term\">Spell Ability:</span>&nbsp;{clazz.spellAbility}</span>}</Typography>\n      {content}\n    </div>;\n  }\n\n}\n\nexport default ClassCard;\n","import * as React from 'react';\r\n\r\nimport { Class } from '../Compendium';\r\nimport SearchableList from '../SearchableList';\r\n\r\nimport ClassCard from '../cards/ClassCard';\r\n\r\n\r\nexport interface Props {\r\n  classes: { [key: string]: Class }\r\n}\r\n\r\nexport default class ClassesTab extends React.Component<Props> {\r\n\r\n  private renderClass = (clazz: any, index: number): JSX.Element => {\r\n    return <ClassCard key={index} clazz={clazz} />;\r\n  }\r\n\r\n  public render() {\r\n    const { classes } = this.props;\r\n    return <SearchableList\r\n      items={classes}\r\n      renderItem={this.renderClass}\r\n    />;\r\n  }\r\n}\r\n","import * as React from 'react';\n\nimport { Race } from '../Compendium';\n\nimport Typography from '@material-ui/core/Typography';\n\nexport interface Props {\n  race: Race\n}\n\nclass RaceCard extends React.Component<Props> {\n\n  public render() {\n    const { race } = this.props;\n    const content: JSX.Element[] = [];\n    let traits = race.trait;\n    if (!(traits instanceof Array)) {\n      traits = [traits];\n    }\n    traits.forEach((trait: any) => {\n      let text = trait.text;\n      if (!(trait.text instanceof Array)) {\n        text = [trait.text];\n      }\n      content.push(\n        <div key={content.length}>\n          <span className=\"term\">{trait.name}</span>\n          <span>&nbsp;{(text as string[]).map((t, j) => <span key={j}>{t}<br /></span>)}</span>\n        </div>\n      );\n    });\n    return <div>\n      <Typography variant=\"h5\">{race.name}</Typography>\n      <Typography><span className=\"term\">Ability:</span>&nbsp;{race.ability}</Typography>\n      <Typography><span className=\"term\">Size:</span>&nbsp;{race.size}</Typography>\n      <Typography><span className=\"term\">Speed:</span>&nbsp;{race.speed}</Typography>\n      {content}\n    </div>;\n  }\n\n}\n\nexport default RaceCard;\n","import * as React from 'react';\r\n\r\nimport { Race } from '../Compendium';\r\nimport RaceCard from '../cards/RaceCard';\r\nimport SearchableList from '../SearchableList';\r\n\r\nexport interface Props {\r\n  races: { [key: string]: Race }\r\n}\r\n\r\nexport default class RacesTab extends React.Component<Props> {\r\n\r\n  private renderRace = (race: Race, index: number): JSX.Element => {\r\n    return <RaceCard key={index} race={race} />;\r\n  }\r\n\r\n  public render() {\r\n    const { races } = this.props;\r\n    return <SearchableList\r\n      items={races}\r\n      renderItem={this.renderRace}\r\n    />;\r\n  }\r\n}\r\n","class TerminalCodes {\n  static Black = \"\\u001b[30m\"\n  static Red = \"\\u001b[31m\"\n  static Green = \"\\u001b[32m\"\n  static Yellow = \"\\u001b[33m\"\n  static Blue = \"\\u001b[34m\"\n  static Magenta = \"\\u001b[35m\"\n  static Cyan = \"\\u001b[36m\"\n  static White = \"\\u001b[37m\"\n  static Reset = \"\\u001b[0m\"\n  static Bold = \"\\u001b[1m\"\n  static Underline = \"\\u001b[4m\"\n  static Reversed = \"\\u001b[7m\"\n  static Up(n?: number): string {\n    if (n === undefined) {\n      return \"\\u001b[A\";\n    }\n    return `\\u001b[${n}A`;\n  }\n  static Down(n?: number): string {\n    if (n === undefined) {\n      return \"\\u001b[B\";\n    }\n    return `\\u001b[${n}B`;\n  }\n  static Right(n?: number): string {\n    if (n === undefined) {\n      return \"\\u001b[C\";\n    }\n    return `\\u001b[${n}C`;\n  }\n  static Left(n?: number): string {\n    if (n === undefined) {\n      return \"\\u001b[D\";\n    }\n    return `\\u001b[${n}D`;\n  }\n  static SetColumn(n: number): string {\n    return `\\u001b[${n}G`;\n  }\n  static SetPosition(n: number, m: number) {\n    return `\\u001b[${n};${m}H`;\n  }\n  // n=0 clears from cursor until end of screen, n=1 clears from cursor to beginning of screen, n=2 clears entire screen\n  static ClearScreen(n: number) {\n    return `\\u001b[${n}J`;\n  }\n  // n=0 clears from cursor to end of line, n=1 clears from cursor to start of line, n=2 clears entire line\n  static ClearLine(n: number) {\n    return `\\u001b[${n}K`;\n  }\n}\n\nexport default TerminalCodes;","import React from 'react';\n\nimport { Terminal as XTerm } from 'xterm';\nimport { FitAddon } from 'xterm-addon-fit';\nimport TerminalCodes from './TerminalCodes';\n\nimport 'xterm/css/xterm.css'\n\nexport interface Writer {\n  write(buf: string): void;\n}\n\nexport interface Reader {\n  read(): Promise<string>;\n}\n\nexport interface Executable {\n  startup(): string;\n  prompt?(): string | undefined;\n  execute(commandLine: string): Promise<number>;\n  cancel(): void;\n  suggestions(commandLine: string): string[];\n  stdin?: Reader;\n  stdout?: Writer;\n  stderr?: Writer;\n}\n\ninterface ShellProps {\n  program: Executable;\n}\n\ninterface ShellState {\n  running?: Executable;\n  commandBuffer: string;\n  tmpBuffer: string;\n  cursor: number;\n  historyIndex: number;\n  history: string[];\n  suggestions: string[];\n}\n\nconst DEFAULT_PROMPT = `${TerminalCodes.Red}${TerminalCodes.Bold}rpg.ai > ${TerminalCodes.Reset}`;\nconst ANSI_ESCAPE_CODES = new RegExp([\n  '[\\\\u001B\\\\u009B][[\\\\]()#;?]*(?:(?:(?:[a-zA-Z\\\\d]*(?:;[-a-zA-Z\\\\d\\\\/#&.:=?%@~_]*)*)?\\\\u0007)',\n  '(?:(?:\\\\d{1,4}(?:;\\\\d{0,4})*)?[\\\\dA-PR-TZcf-ntqry=><~]))'\n].join('|'), 'g');\n\nclass Shell extends React.Component<ShellProps, ShellState> {\n\n  term: XTerm;\n  fitAddon: FitAddon;\n  termEl: HTMLElement | null | undefined;\n  reader?: (buf: string) => void;\n\n  constructor(props: any) {\n  super(props);\n  this.props.program.stdin = this;\n  this.props.program.stdout = this;\n  this.props.program.stderr = this;\n  this.term = new XTerm();\n  this.fitAddon = new FitAddon();\n  this.state = {\n    commandBuffer: \"\",\n    tmpBuffer: \"\",\n    cursor: 0,\n    historyIndex: 0,\n    history: [],\n    suggestions: [],\n  };\n  }\n\n  componentDidMount() {\n  if (this.termEl === null || this.termEl === undefined) {\n    return;\n  }\n  this.term.loadAddon(this.fitAddon);\n  this.term.open(this.termEl);\n  this.term.onData(this.handleData.bind(this));\n  this.fitAddon.fit();\n  const startupMsg = this.props.program.startup();\n  if (startupMsg) {\n    this.write(startupMsg);\n  }\n  this.displayPrompt();\n  }\n\n  up() {\n  const { historyIndex, commandBuffer, tmpBuffer } = this.state;\n  if (historyIndex - 1 < 0) {\n    return;\n  }\n  const newIndex = historyIndex - 1;\n  this.setState({\n    ...this.state,\n    historyIndex: newIndex,\n    commandBuffer: this.state.history[newIndex],\n    tmpBuffer: historyIndex === this.state.history.length ? commandBuffer : tmpBuffer,\n    cursor: this.state.history[newIndex].length,\n  })\n  }\n\n  down() {\n  const { historyIndex, tmpBuffer } = this.state;\n  if (historyIndex + 1 >= this.state.history.length) {\n    this.setState({\n    ...this.state,\n    historyIndex: this.state.history.length,\n    commandBuffer: tmpBuffer,\n    cursor: tmpBuffer.length,\n    });\n    return;\n  }\n  const newIndex = historyIndex + 1;\n  this.setState({\n    ...this.state,\n    historyIndex: newIndex,\n    commandBuffer: this.state.history[newIndex],\n    cursor: 0,\n  })\n  }\n\n  left() {\n  const { cursor } = this.state;\n  this.setState({\n    ...this.state,\n    cursor: Math.max(0, cursor - 1),\n  })\n  }\n\n  right() {\n  const { commandBuffer, cursor } = this.state;\n  this.setState({\n    ...this.state,\n    cursor: Math.min(commandBuffer.length, cursor + 1),\n  })\n  }\n\n  delete() {\n  const { commandBuffer, cursor } = this.state;\n  this.setState({\n    ...this.state,\n    cursor: Math.max(0, cursor - 1),\n    commandBuffer: commandBuffer.substring(0, cursor - 1) + commandBuffer.substring(cursor, commandBuffer.length),\n  });\n  }\n\n  addCharacter(data: string) {\n  const { commandBuffer, cursor } = this.state;\n  this.setState({\n    ...this.state,\n    cursor: this.state.cursor + 1,\n    commandBuffer: commandBuffer.substring(0, cursor) + data + commandBuffer.substring(cursor, commandBuffer.length),\n  })\n  }\n\n  handleData(data: string) {\n  const c = data.charCodeAt(0);\n  if (c === 27) { // ESC\n    switch (data) {\n    case TerminalCodes.Up():\n      this.up();\n      break;\n    case TerminalCodes.Down():\n      this.down();\n      break;\n    case TerminalCodes.Left():\n      this.left();\n      break;\n    case TerminalCodes.Right():\n      this.right();\n      break;\n    }\n  } else if (c === 127) { // DEL\n    this.delete();\n  } else if (c === 13) { // CR\n    if (this.reader) {\n    this.reader(this.state.commandBuffer);\n    this.reader = undefined;\n    this.setState({\n      ...this.state,\n      cursor: 0,\n      commandBuffer: \"\",\n      tmpBuffer: \"\",\n    });\n    } else {\n    this.runCommand();\n    }\n  } else if (c === 9) { // TAB\n    const suggestions = this.props.program.suggestions(this.state.commandBuffer);\n    if (suggestions.length === 1) {\n    this.setState({\n      ...this.state,\n      commandBuffer: suggestions[0],\n    });\n    } else {\n    this.setState({\n      ...this.state,\n      suggestions: suggestions,\n    });\n    }\n  } else if (c === 3 && this.state.running) { // CTRL-C\n    this.state.running.cancel();\n    this.setState({\n    ...this.state,\n    running: undefined,\n    });\n  } else {\n    this.addCharacter(data);\n    if (this.state.running) {\n    this.write(data);\n    }\n  }\n  if (!this.state.running) {\n    this.displayPrompt();\n  }\n  }\n\n  write(buf: string) {\n  this.term.write(buf);\n  }\n\n  read(): Promise<string> {\n  return new Promise<string>((resolve) => {\n    this.reader = resolve;\n  });\n  }\n\n  displayPrompt() {\n  this.term.write(TerminalCodes.SetColumn(0));\n  const prompt = this.props.program.prompt?.call(this.props.program) || DEFAULT_PROMPT;\n  this.term.write(prompt);\n  this.term.write(TerminalCodes.ClearLine(0));\n  this.term.write(this.state.commandBuffer);\n  this.term.write(TerminalCodes.ClearScreen(0));\n  if (this.state.suggestions.length > 0) {\n    this.term.write('\\r\\n');\n    this.state.suggestions\n    .forEach((suggestion) => {\n      this.term.write(suggestion);\n      this.term.write('\\r\\n');\n    });\n    this.term.write(TerminalCodes.Up(this.state.suggestions.length + 1));\n  }\n  this.term.write(TerminalCodes.SetColumn(prompt.replace(ANSI_ESCAPE_CODES, '').length + this.state.cursor + 1));\n  }\n\n  async runCommand() {\n  const { program } = this.props;\n  const { commandBuffer, history } = this.state;\n  const prompt = this.props.program.prompt?.call(this.props.program) || DEFAULT_PROMPT;\n  this.term.write(TerminalCodes.SetColumn(prompt.replace(ANSI_ESCAPE_CODES, '').length + this.state.commandBuffer.length + 1));\n  this.term.write(TerminalCodes.ClearScreen(0));\n  this.term.write('\\r\\n');\n  if (commandBuffer === 'history') {\n    this.write(this.state.history.join('\\r\\n'));\n  } else if (commandBuffer === 'clear') {\n    this.term.write(TerminalCodes.SetPosition(1, 1));\n    this.term.write(TerminalCodes.ClearScreen(2));\n  } else {\n    this.setState({\n    ...this.state,\n    running: program,\n    commandBuffer: \"\",\n    tmpBuffer: \"\",\n    cursor: 0,\n    suggestions: [],\n    });\n    await program.execute(commandBuffer);\n    if (commandBuffer && commandBuffer !== history[history.length - 1]) {\n    history.push(commandBuffer);\n    }\n  }\n  this.setState({\n    ...this.state,\n    running: undefined,\n    commandBuffer: \"\",\n    tmpBuffer: \"\",\n    cursor: 0,\n    historyIndex: history.length,\n    history: history,\n  });\n  this.displayPrompt();\n  }\n\n  render() {\n  return (\n    <div\n    style={{\n      height: '100%',\n    }}\n    ref={el => this.termEl = el}\n    />\n  );\n  }\n}\n\nexport default Shell;\n","import React from 'react';\nimport styled from 'styled-components';\n\nimport Shell from '../Shell';\nimport MonsterCard from '../cards/MonsterCard';\nimport SpellCard from '../cards/SpellCard';\nimport ItemCard from '../cards/ItemCard';\nimport GameState from '../GameState';\n\nconst Root = styled.div`\n  height: 100%;\n  .top-panel {\n  height: 60%;\n  display: flex;\n  flex-direction: row;\n  overflow: scroll;\n  }\n  .top-panel .table {\n  width: 60%;\n  margin: 15px;\n  border-collapse: collapse;\n  }\n  .top-panel .table tr {\n  border-bottom: 1px solid #888;\n  }\n  .top-panel .table td {\n  padding: 1vh;\n  font-size: 1.5vh;\n  }\n  .top-panel .card-container {\n  width: 40%;\n  margin: 15px;\n  }\n  .shell-container {\n  height: 40%;\n  }\n  .highlight {\n  background-color: #a1e3ff;\n  }\n`;\n\nexport default function EncounterTab(props: { game: GameState }) {\n  const selection = props.game.selected || props.game.encounter[props.game.currentIndex];\n  const rows = props.game.encounter.map((e, index) => <tr\n    key={index}\n    className={index === props.game.currentIndex ? 'highlight' : ''}\n    onClick={() => { props.game.currentIndex = index; props.game.onChange() }}\n  >\n    <td align=\"left\">{index + 1}</td>\n    <td align=\"center\">{e.name}</td>\n    <td align=\"right\">{e.cr}</td>\n    <td align=\"right\">{e.status?.initiative}</td>\n    <td align=\"right\">{e.status?.hp || ''}</td>\n    <td align=\"right\">{e.ac || ''}</td>\n    <td align=\"right\">{e.status?.conditions.join(',') || ''}</td>\n  </tr>);\n  return (<Root>\n    <div className=\"top-panel\">\n      <table className=\"table\" aria-label=\"encounter\">\n        <thead>\n          <tr>\n            <td align=\"left\"></td>\n            <td>Name</td>\n            <td align=\"right\">CR</td>\n            <td align=\"right\">Initiative</td>\n            <td align=\"right\">HP</td>\n            <td align=\"right\">AC</td>\n            <td align=\"right\">Conditions</td>\n          </tr>\n        </thead>\n        <tbody>{rows}</tbody>\n      </table>\n      <div className=\"card-container\">\n        {selection && selection.kind === 'monster' && <MonsterCard monster={selection} />}\n        {selection && selection.kind === 'spell' && <SpellCard spell={selection} />}\n        {selection && selection.kind === 'item' && <ItemCard item={selection} />}\n      </div>\n    </div>\n    <div className=\"shell-container\">\n      <Shell program={props.game} />\n    </div>\n  </Root>);\n}\n","import { Compendium, CompendiumItem, Monster } from './Compendium';\nimport { Executable, Reader, Writer } from './Shell';\nimport Levenshtein from 'fast-levenshtein';\n\nclass Command {\n  command: string\n  args: Argument[]\n  regex: RegExp\n  syntax: string\n  help: string\n  f: Function\n\n  constructor(syntax: string, help: string, f: Function) {\n    this.syntax = syntax;\n    this.help = help;\n    this.f = f;\n    const groups = syntax.split('<');\n    this.command = groups[0].trim();\n    groups.shift();\n    this.args = groups.map((group) => {\n      const [name, type] = group.replace('>', '').split(': ');\n      return {\n        name: name.trim().replace('?', ''),\n        type: type.trim(),\n        optional: name.endsWith('?'),\n      };\n    });\n    this.regex = new RegExp(this.args.map(arg => {\n      if (arg.type === 'number') {\n        return '(-?[-\\\\d]' + (arg.optional ? '*' : '+') + ')';\n      } else if (arg.type === 'number[]') {\n        return '(-?[\\\\d,]' + (arg.optional ? '*' : '+') + ')';\n      } else {\n        return '(.' + (arg.optional ? '*?' : '+?') + ')';\n      }\n    }).join('\\\\s+') + '$');\n  }\n\n  execute(game: GameState, commandLine: string) {\n    game.log?.write(`executing ${this.syntax}\\r\\n`);\n    return this.f.apply(game, this.parse(commandLine, game.log));\n  }\n\n  parse(commandLine: string, out?: Writer): (string | number | number[] | undefined)[] {\n    const match = commandLine.match(this.regex);\n    out?.write(`\"${commandLine}\".match(/${this.regex}/)\\r\\n`)\n    out?.write(JSON.stringify(match) + \"\\r\\n\")\n    if (!match) return [commandLine];\n    return match.slice(1, match.length).map((arg, index) => {\n      arg = arg.trim();\n      out?.write(`arg ${index}: \"${arg}\": ${this.args[index].type}\\r\\n`)\n      switch (this.args[index].type) {\n        case \"number\":\n          if (isNaN(parseInt(arg))) {\n            if (this.args[index].optional) {\n              return undefined;\n            }\n            throw new Error(`failed to parse ${arg} as non-optional argument ${this.args[index].name}: number`);\n          }\n          return parseInt(arg);\n        case \"number[]\":\n          const numbers = arg.split(',').map((s => parseInt(s.trim())));\n          if (numbers.length === 0 || numbers.some(isNaN)) {\n            if (this.args[index].optional) {\n              return undefined;\n            }\n            throw new Error(`failed to parse ${arg} as non-optional argument ${this.args[index].name}: number[]`);\n          }\n          return numbers;\n        case \"string | number\":\n          if (isNaN(parseInt(arg))) {\n            return arg;\n          }\n          return parseInt(arg);\n        case \"string\":\n          return arg;\n        default:\n          throw new Error(`error parsing ${commandLine}, unknown type ${this.args[index].type}`);\n      }\n    });\n  }\n}\n\ninterface Argument {\n  name: string\n  type: string\n  optional: boolean\n}\n\nconst commands: { [key: string]: Command } = {};\nfunction command(syntax: string, help: string) {\n  return function (target: any, propertyKey: string, descriptor: PropertyDescriptor) {\n    const command = new Command(syntax, help, descriptor.value);\n    commands[command.command] = command;\n  }\n}\n\nfunction roll(d: number, count?: number): number {\n  let sum = 0;\n  if (count === undefined) count = 1;\n  for (; count > 0; count--) {\n    sum += Math.floor(Math.random() * d) + 1;\n  }\n  return sum;\n}\n\nfunction repr(e: Monster, index: number): string {\n  return `${index + 1}. ${e.name}`;\n}\n\nclass GameState implements Executable {\n  compendium: Compendium = new Compendium();\n  setState: (g: GameState) => void;\n\n  motd: Monster;\n\n  // Persisted to local storage\n  showStartup: boolean = true;\n  encounter: Array<Monster> = [];\n  currentIndex: number = 0;\n  selected?: CompendiumItem;\n\n  stdin?: Reader;\n  stdout?: Writer;\n  stderr?: Writer;\n  log?: Writer;\n\n  constructor(compendium: Compendium, setState: (g: GameState) => void) {\n    this.compendium = compendium;\n    this.setState = setState;\n    const monsterNames = Object.keys(this.compendium.monsters);\n    this.motd = this.compendium.monsters[monsterNames[Math.floor(Math.random() * monsterNames.length)]];\n    const savedState = window.localStorage.getItem('dnd5e.gamestate');\n    if (savedState) {\n      const state = JSON.parse(savedState);\n      Object.assign(this, state);\n    }\n  }\n\n  onChange() {\n    this.setState(this);\n    window.localStorage.setItem('dnd5e.gamestate', JSON.stringify(this));\n  }\n\n  toJSON() {\n    return {\n      showStartup: this.showStartup,\n      encounter: this.encounter,\n      currentIndex: this.currentIndex,\n    };\n  }\n\n  resetState() {\n    this.showStartup = true;\n    this.encounter = [];\n    this.currentIndex = 0;\n    this.selected = undefined;\n  }\n\n  async execute(commandLine: string): Promise<number> {\n    let command = undefined;\n\n    for (const key of Object.keys(commands)) {\n      if (commandLine.startsWith(key)) {\n        command = commands[key];\n        commandLine = commandLine.replace(key, '').trim();\n        break;\n      }\n    }\n    if (command === undefined) {\n      this.stderr?.write(`unknown command: ${commandLine}\\r\\n`);\n      return 1;\n    }\n    let result;\n    try {\n      result = await command.execute(this, commandLine);\n    } catch (err) {\n      console.error(err);\n      if (err) {\n        this.stderr?.write(err.toString());\n        this.stderr?.write('\\r\\n');\n      } else {\n        this.stderr?.write(\"unknown error\\r\\n\");\n      }\n      return 1;\n    }\n    if (typeof result === 'string') {\n      this.stdout?.write(result);\n      this.stdout?.write('\\r\\n');\n    } else if (result instanceof Promise) {\n      try {\n        result = await result;\n      } catch {\n        return 1;\n      }\n    }\n    this.onChange();\n    return 0;\n  }\n\n  cancel(): void {\n  }\n\n  suggestions(partial: string): Array<string> {\n    if (partial === \"\") {\n      return Object.keys(commands);\n    }\n    for (const key of Object.keys(commands)) {\n      if (partial.startsWith(key)) {\n        partial = partial.replace(key, '').trim();\n        break;\n      }\n    }\n    return this.search(partial).map((item) => item.name).slice(0, 10);\n  }\n\n  startup() {\n    if (!this.showStartup) return '';\n\n    let msg = `Welcome to rpg.ai, the shell for the busy DM!\\r\\nLoaded the DND5E Compendium.\\r\\nMonster of the day: ${this.motd?.name}\\r\\n`;\n\n    if (this.encounter.length > 0) {\n      msg += `Resuming your encounter with ${this.encounter.map((i) => i.name).join(', ')}\\r\\n`;\n    }\n    msg += \"\\r\\n\";\n    return msg;\n  }\n\n  search(query: string, kinds?: string[]): CompendiumItem[] {\n    let items: CompendiumItem[] = [];\n    if (kinds === undefined || kinds?.includes('background')) {\n      items = items.concat(Object.values(this.compendium.backgrounds));\n    }\n    if (kinds === undefined || kinds?.includes('class')) {\n      items = items.concat(Object.values(this.compendium.classes));\n    }\n    if (kinds === undefined || kinds?.includes('feat')) {\n      items = items.concat(Object.values(this.compendium.feats));\n    }\n    if (kinds === undefined || kinds?.includes('item')) {\n      items = items.concat(Object.values(this.compendium.items));\n    }\n    if (kinds === undefined || kinds?.includes('monster')) {\n      items = items.concat(Object.values(this.compendium.monsters));\n    }\n    if (kinds === undefined || kinds?.includes('race')) {\n      items = items.concat(Object.values(this.compendium.races));\n    }\n    if (kinds === undefined || kinds?.includes('spell')) {\n      items = items.concat(Object.values(this.compendium.spells));\n    }\n    const editDistance = items.map((item, index) => {\n      return { index: index, distance: Levenshtein.get(query.toLowerCase(), item.name.toLowerCase()) };\n    });\n    editDistance.sort((a, b) => {\n      if (a.distance < b.distance) return -1;\n      if (a.distance > b.distance) return 1;\n      return 0;\n    });\n    return editDistance.map((item) => items[item.index]);\n  }\n\n  targets(a: number[]): Monster[] {\n    return a.map(i => this.encounter[i - 1]);\n  }\n\n  @command('help <command?: string>', 'this help message')\n  help(command?: string) {\n    if (!command || !(command in commands)) {\n      return Array.from(Object.values(commands)).map((command) => `${command.syntax} - ${command.help}`).sort().join('\\r\\n');\n    }\n    return `${commands[command].syntax} - ${commands[command].help}`;\n  }\n\n  @command('welcome', 'toggle welcome message')\n  welcome() {\n    this.showStartup = !this.showStartup;\n    return `welcome message ${this.showStartup ? 'on' : 'off'}`;\n  }\n\n  @command('new', 'start a new encounter')\n  newEncounter() {\n    this.encounter = [];\n    return \"started new encounter\";\n  }\n\n  @command('reset', 'clear all saved state')\n  async reset() {\n    this.stdout?.write(\"are you sure (y/n)? \");\n    const response = await this.stdin?.read();\n    if (response === 'y') {\n      this.resetState();\n      return '\\r\\ncleared all saved state';\n    } else {\n      return \"\\r\\ncancelled reset\";\n    };\n  }\n\n  @command('player <name: string> <level?: number>', 'add a player')\n  addPlayer(name: string, level?: number) {\n    this.encounter.push({\n      name: name,\n      kind: 'monster',\n      hp: '',\n      ac: NaN,\n      cr: level || NaN,\n      passive: NaN,\n      size: '',\n      speed: '',\n      str: NaN,\n      dex: NaN,\n      con: NaN,\n      int: NaN,\n      wis: NaN,\n      cha: NaN,\n      alignment: '',\n      type: 'player',\n      compendium: {},\n      status: {\n        hp: NaN,\n        maxHP: NaN,\n        x: 0,\n        y: 0,\n        damage: [],\n        saves: [],\n        actions: [],\n        reactions: [],\n        legendaries: [],\n        conditions: [],\n        initiative: NaN,\n        spellSlots: [],\n        spellcasting: undefined,\n      }\n    });\n    return `added player ${name}`;\n  }\n\n  @command('add <name: string> <times?: number>', 'add a monster the current encounter')\n  add(name: string, times?: number) {\n    const results = this.search(name, ['monster']);\n    if (results.length === 0) {\n      return `no match found for ${name}`;\n    }\n    times = (times || 1);\n    for (let i = 0; i < times; i++) {\n      const monster = JSON.parse(JSON.stringify(results[0]));\n      monster.status = {\n        initiative: roll(20) + Compendium.modifier(monster.dex),\n        level: NaN,\n        x: 10,\n        y: 12,\n        damage: [],\n        saves: [],\n        actions: [],\n        reactions: [],\n        legendaries: [],\n        conditions: [],\n        spellSlots: this.compendium.parseSpellSlots(monster),\n      };\n      const hpDesc = this.compendium.parseHP(monster);\n      if (hpDesc) {\n        monster.status.hp = roll(hpDesc.die, hpDesc.num) + (isNaN(hpDesc.bonus) ? 0 : hpDesc.bonus);\n        monster.status.maxHP = monster.status.hp;\n      }\n      monster.status.spellcasting = this.compendium.parseSpellcasting(monster);\n      this.encounter.push(monster);\n    }\n    return `added ${times} ${results[0].name}`;\n  }\n\n  @command('rm <targets: number[]>', 'remove a monster or player from the current encounter')\n  removeEntity(targets: number[]) {\n    this.targets(targets).forEach((target) => {\n      const removed = this.encounter.splice(this.encounter.indexOf(target), 1)[0];\n      return `removed ${removed.name}`;\n    });\n  }\n\n  @command('condition <targets: number[]> <condition: string>', 'toggle a condition')\n  condition(targets: number[], condition: string) {\n    condition = condition.toLowerCase();\n    this.targets(targets).forEach((target) => {\n      if (target.status?.conditions.indexOf(condition) !== -1) {\n        target.status?.conditions.splice(target.status?.conditions.indexOf(condition), 1);\n      } else {\n        target.status?.conditions.push(condition);\n      }\n    });\n  }\n\n  @command('ls', 'list the status of the current encounter')\n  listEncounter() {\n    return this.encounter.map(repr).join('\\r\\n');\n  }\n\n  @command('balance', 'check the balance of the current encounter')\n  balance() {\n    const encounterXP = this.encounter.reduce((sum, monster) => {\n      if (monster.type === 'player') return sum;\n      if (!monster.cr) return sum;\n      if (monster.cr in Compendium.cr_to_xp) return sum + Compendium.cr_to_xp[monster.cr];\n      return sum;\n    }, 0);\n    const playerLevels = this.encounter.filter(monster => monster.type === 'player').map(player => {\n      if (typeof player.cr === 'string') {\n        return parseInt(player.cr);\n      }\n      return player.cr;\n    });\n    const levels = [3, 2, 1, 0].map(index => {\n      return playerLevels.reduce((sum, level) => {\n        return sum + Compendium.encounter_difficulty[level][index];\n      }, 0);\n    });\n    const difficultyLevel = levels.filter(xp => encounterXP > xp).length;\n    const difficulty = ['deadly', 'hard', 'medium', 'easy', 'trivial'][4 - difficultyLevel];\n    if (difficulty === 'deadly') {\n      return 'deadly';\n    }\n    const xpToNextLevel = levels[3 - difficultyLevel] - encounterXP;\n    return `${difficulty}: CR ${Compendium.xp_to_cr(xpToNextLevel)} to next level`;\n  }\n\n  @command('init', 'roll initiative')\n  async rollInitiative() {\n    for (const e of this.encounter) {\n      if (!e.status) continue;\n      if (e.dex === null) {\n        e.status.initiative = NaN;\n        continue;\n      }\n      e.status.initiative = roll(20) + Compendium.modifier(e.dex);\n    }\n    this.onChange();\n    for (const e of this.encounter) {\n      if (e.status && !e.status.initiative) {\n        this.stdout?.write(`initiative for ${e.name}? `);\n        if (!this.stdin) return;\n        e.status.initiative = parseInt(await this.stdin.read());\n        this.onChange();\n        this.stdout?.write(\"\\r\\n\");\n      }\n    }\n    this.encounter.sort((a, b) => {\n      return (b.status?.initiative || 0) - (a.status?.initiative || 0);\n    });\n  }\n\n  @command('curr <i?: number>', 'set the current turn to index i, default: show the current turn')\n  currTurn(i?: number) {\n    if (this.encounter.length === 0) {\n      return 'empty encounter';\n    }\n    if (i) {\n      this.currentIndex = i - 1;\n    }\n    this.selected = this.encounter[this.currentIndex];\n    return repr(this.encounter[this.currentIndex], this.currentIndex);\n  }\n\n  @command('next', 'advance turn to the next entity')\n  nextTurn() {\n    if (this.encounter.length === 0) {\n      return 'empty encounter';\n    }\n    this.currentIndex++;\n    this.currentIndex = this.currentIndex % this.encounter.length;\n    this.selected = this.encounter[this.currentIndex];\n    return this.currTurn();\n  }\n\n  @command('prev', 'rollback the turn by one entity')\n  prevTurn() {\n    if (this.encounter.length === 0) {\n      return 'empty encounter';\n    }\n    this.currentIndex--;\n    if (this.currentIndex === -1) {\n      this.currentIndex = this.encounter.length - 1;\n    }\n    this.selected = this.encounter[this.currentIndex];\n    return this.currTurn();\n  }\n\n  @command('dmg <targets: number[]> <points: number>', 'damage target')\n  async dmg(targets: number[], points: number) {\n    this.log?.write(`${JSON.stringify(targets)} ${points}\\r\\n`);\n    for (const target of this.targets(targets)) {\n      if (!target.status) {\n        this.stdout?.write(`${target.name} has no status\\r\\n`);\n        continue;\n      }\n      this.selected = target;\n      let damage = points;\n      if (target.vulnerable || target.resist || target.immune) {\n        let multiplier = 1;\n        if (target.vulnerable) {\n          this.stdout?.write(`Vulnerable: ${target.vulnerable} (y/n)? `);\n          if (await this.stdin?.read() === 'y') {\n            multiplier = 2;\n          }\n          this.stdout?.write('\\r\\n');\n        }\n        if (target.resist) {\n          this.stdout?.write(`Resist: ${target.resist} (y/n)? `);\n          if (await this.stdin?.read() === 'y') {\n            multiplier = 0.5;\n          }\n          this.stdout?.write('\\r\\n');\n        }\n        if (target.immune) {\n          this.stdout?.write(`Immune: ${target.immune} (y/n)? `);\n          if (await this.stdin?.read() === 'y') {\n            multiplier = 0;\n          }\n          this.stdout?.write('\\r\\n');\n        }\n        damage = Math.floor(points * multiplier);\n      }\n      target.status.hp -= damage;\n      target.status.damage.push({\n        name: \"\",\n        text: damage.toString(),\n      });\n      if (target.type !== 'player') {\n        if (target.status?.hp <= Math.floor(target.status?.maxHP / 2)) {\n          if (!target.status.conditions.includes('bloodied')) target.status.conditions.push('bloodied');\n        } else {\n          if (target.status.conditions.includes('bloodied')) target.status?.conditions.splice(target.status?.conditions.indexOf('bloodied'), 1);\n        }\n      }\n      this.stdout?.write(`${target.name} took ${damage} points of damage\\r\\n`);\n    }\n  }\n\n  @command('dc <dc: number> <attribute: string> <targets?: number[]>', 'roll a saving throw')\n  save(dc: number, attribute: string, targets?: number[]) {\n    attribute = attribute.toLowerCase();\n    const attr = Compendium.abilities.find((a: string) => (a.toLowerCase().substring(0, 3) === attribute));\n    if (!attr) {\n      this.stderr?.write(`unknown attribute ${attribute}\\r\\n`);\n      return;\n    }\n    if (!targets) {\n      targets = [this.currentIndex + 1];\n    }\n    this.targets(targets).forEach((target) => {\n      const targetAbility = (target as any)[attr.substring(0, 3).toLowerCase()];\n      const savingThrow = roll(20, 1);\n      const modifier = Compendium.modifier(targetAbility);\n      const result = (savingThrow + modifier) >= dc ? 'passes' : 'fails';\n      this.stdout?.write(`${target.name} rolls a ${savingThrow + modifier} (${savingThrow}+${modifier}) and ${result}\\r\\n`);\n      target.status?.saves.push({\n        name: attribute,\n        text: result,\n      });\n    });\n  }\n\n  @command('use <action: number> <targets?: number[]>', 'perform actions')\n  use(action: number, targets: number[] | undefined) {\n    if (!targets || isNaN(targets[0])) {\n      targets = [this.currentIndex + 1];\n    }\n    this.targets(targets).forEach((target) => {\n      if (!target.action) return;\n      let actions;\n      if (target.action instanceof Array) {\n        actions = target.action;\n      } else {\n        actions = [target.action];\n      }\n      const a = actions[action - 1];\n      target.status?.actions.push(a);\n      let texts = a.text;\n      if (!(texts instanceof Array)) {\n        texts = [texts];\n      }\n      this.stdout?.write(texts.join('\\r\\n'));\n      this.stdout?.write(\"\\r\\n\");\n    });\n  }\n\n  @command('show <query: string>', 'show a card for the given item')\n  show(query: string) {\n    const results = this.search(query);\n    if (results.length === 0) {\n      return `no match found for ${query}`;\n    }\n    this.selected = results[0];\n  }\n\n  @command('monster <query: string>', 'search and show monsters')\n  monster(query: string) {\n    const results = this.search(query, ['monster']);\n    if (results.length === 0) {\n      return `no match found for ${query}`;\n    }\n    this.selected = results[0];\n  }\n\n  @command('spell <query: string>', 'search and show spells')\n  spell(query: string) {\n    const results = this.search(query, ['spell']);\n    if (results.length === 0) {\n      return `no match found for ${query}`;\n    }\n    this.selected = results[0];\n  }\n\n  @command('item <query: string>', 'search and show items')\n  item(query: string) {\n    const results = this.search(query, ['item']);\n    if (results.length === 0) {\n      return `no match found for ${query}`;\n    }\n    this.selected = results[0];\n  }\n\n  @command('roll <desc: string>', 'roll them bones')\n  roll(desc: string) {\n    const m = desc.match(/(\\d+)d(\\d+)[+]?(\\d+)?/);\n    if (m) {\n      const n = parseInt(m[1]);\n      const die = parseInt(m[2]);\n      const bonus = parseInt(m[3]);\n      this.stdout?.write(`${roll(die, n) + (bonus || 0)}\\r\\n`);\n    }\n  }\n\n  @command('cast <name: string> <level?: number>', 'cast a spell')\n  cast(name: string, level: number | undefined) {\n    const curr = this.encounter[this.currentIndex];\n    const match = curr.status?.spellSlots.map((slot, level) => {\n      return slot.spells.map((spell) => {\n        return {\n          level: level,\n          slot: slot,\n          spell: spell,\n          distance: Levenshtein.get(name.toLowerCase(), spell.name.toLowerCase()),\n        }\n      });\n    }).flat().sort((a, b) => {\n      if (a.distance < b.distance) return -1;\n      if (a.distance > b.distance) return 1;\n      return 0;\n    })[0];\n    if (!match) {\n      return;\n    }\n    let slot = match.slot;\n    if (level && curr.status?.spellSlots) {\n      slot = curr.status?.spellSlots[level];\n    }\n    if (slot.slots <= 0) {\n      return `${curr.name} has no more slots at level ${level || match.level}!`;\n    }\n    slot.slots -= 1;\n    this.show(match.spell.name);\n    return `${curr.name} casts ${match.spell.name} at level ${level || match.level}!`;\n  }\n\n  @command('debug', 'toggle debugging')\n  toggleDebug() {\n    if (this.log) {\n      this.log = undefined;\n    } else {\n      this.log = this.stderr;\n    }\n    this.stdout?.write(`debug ${this.log ? 'on' : 'off'}\\r\\n`);\n  }\n\n  @command('poke <path: string> <value: string | number>', 'poke variables for debugging')\n  poke(path: string, value: string | number) {\n    let curr = this;\n    const keys = path.split('.');\n    for (let key of keys.slice(0, keys.length - 1)) {\n      const match = Object.entries(curr).find(entry => entry[0] === key);\n      if (!match) {\n        throw new Error(`no match found at ${key}`);\n      }\n      curr = match[1];\n    }\n    (curr as any)[keys[keys.length - 1]] = value;\n  }\n\n}\n\nexport default GameState","import * as React from 'react';\r\n\r\nimport AppBar from '@material-ui/core/AppBar';\r\nimport Button from '@material-ui/core/Button';\r\nimport CircularProgress from '@material-ui/core/CircularProgress';\r\nimport IconButton from '@material-ui/core/IconButton';\r\nimport MenuIcon from '@material-ui/icons/Menu';\r\nimport Snackbar from '@material-ui/core/Snackbar';\r\nimport SwipeableDrawer from '@material-ui/core/SwipeableDrawer';\r\nimport Toolbar from '@material-ui/core/Toolbar';\r\nimport Tabs from '@material-ui/core/Tabs';\r\nimport Tab from '@material-ui/core/Tab';\r\nimport Typography from '@material-ui/core/Typography';\r\n\r\nimport './App.css';\r\nimport Compendium from './Compendium';\r\nimport SpellsTab from './tabs/SpellsTab';\r\nimport ItemsTab from './tabs/ItemsTab';\r\nimport MonstersTab from './tabs/MonstersTab';\r\nimport BackgroundsTab from './tabs/BackgroundsTab';\r\nimport FeatsTab from './tabs/FeatsTab';\r\nimport ClassesTab from './tabs/ClassesTab';\r\nimport RacesTab from './tabs/RacesTab';\r\nimport EncounterTab from './tabs/EncounterTab';\r\nimport GameState from './GameState';\r\n\r\ninterface State {\r\n  drawerOpen: boolean\r\n  tabSelected: number\r\n  game: GameState\r\n  compendium: Compendium\r\n  snackbarOpen: boolean\r\n  snackbarMessage?: { key: number, message: string }\r\n}\r\n\r\nexport default class App extends React.Component<{}, State> {\r\n\r\n  private snackbarQueue: { key: number, message: string }[] = [];\r\n\r\n  public constructor(props: {}) {\r\n    super(props);\r\n    const compendium = new Compendium();\r\n    compendium.load().then(() => {\r\n      this.setState({\r\n        ...this.state,\r\n        compendium: compendium,\r\n      });\r\n    });\r\n    this.state = {\r\n      drawerOpen: false,\r\n      tabSelected: 0,\r\n      compendium: compendium,\r\n      game: new GameState(compendium, (game: GameState) => {\r\n        this.setState({\r\n          ...this.state,\r\n          game: game,\r\n        });\r\n      }),\r\n      snackbarOpen: false,\r\n      snackbarMessage: undefined,\r\n    };\r\n  }\r\n\r\n  private toggleDrawer = (open: boolean) => {\r\n    return (event: React.MouseEvent<HTMLButtonElement>) => {\r\n      this.setState({\r\n        ...this.state,\r\n        drawerOpen: !this.state.drawerOpen,\r\n      });\r\n    };\r\n  }\r\n\r\n  private selectTab = (event: React.MouseEvent<HTMLButtonElement>) => {\r\n    const selectedTab = parseInt(event.currentTarget.dataset.tabindex || '0');\r\n    this.setState({\r\n      ...this.state,\r\n      tabSelected: selectedTab,\r\n    });\r\n  }\r\n\r\n  private handleTabChange = (event: React.ChangeEvent<{}>, value: number) => {\r\n    this.setState({\r\n      ...this.state,\r\n      tabSelected: value,\r\n    });\r\n  }\r\n\r\n  public addSnackbarMessage = (message: string) => {\r\n    this.snackbarQueue.push({ message: message, key: new Date().getTime() });\r\n    if (this.state.snackbarOpen) {\r\n      this.setState({ snackbarOpen: false });\r\n    } else {\r\n      this.processSnackbarQueue();\r\n    }\r\n  }\r\n\r\n  private handleSnackbarClosed = () => {\r\n    this.setState({ snackbarOpen: false });\r\n  }\r\n\r\n  private handleSnackbarExited = () => {\r\n    this.processSnackbarQueue();\r\n  }\r\n\r\n  private processSnackbarQueue = () => {\r\n    if (this.snackbarQueue.length > 0) {\r\n      this.setState({\r\n        snackbarOpen: true,\r\n        snackbarMessage: this.snackbarQueue.shift(),\r\n      });\r\n    }\r\n  }\r\n\r\n  public render() {\r\n    return <div style={{ height: '100%' }} className=\"column\">\r\n      <AppBar position=\"static\">\r\n        <Toolbar className=\"justify-content-space-between\">\r\n          <IconButton color=\"inherit\" aria-label=\"Menu\" onClick={this.toggleDrawer(true)}>\r\n            <MenuIcon />\r\n          </IconButton>\r\n          {!this.state.compendium.loaded && <CircularProgress color=\"secondary\" />}\r\n          <Tabs value={this.state.tabSelected} onChange={this.handleTabChange} className=\"flex-1\">\r\n            <Tab label=\"Spells\" />\r\n            <Tab label=\"Items\" />\r\n            <Tab label=\"Monsters\" />\r\n            <Tab label=\"Backgrounds\" />\r\n            <Tab label=\"Feats\" />\r\n            <Tab label=\"Classes\" />\r\n            <Tab label=\"Races\" />\r\n            <Tab label=\"Encounter\" />\r\n          </Tabs>\r\n        </Toolbar>\r\n      </AppBar>\r\n      <SwipeableDrawer open={this.state.drawerOpen} onClose={this.toggleDrawer(false)} onOpen={this.toggleDrawer(true)}>\r\n        <Typography className=\"align-self-center\" variant=\"h5\" style={{ marginTop: '5px' }}>D&amp;D Binder</Typography>\r\n        <Button data-tabindex=\"0\" onClick={this.selectTab} style={{ fontSize: '20px', textAlign: 'left' }}>Spells</Button>\r\n        <Button data-tabindex=\"1\" onClick={this.selectTab} style={{ fontSize: '20px', textAlign: 'left' }}>Items</Button>\r\n        <Button data-tabindex=\"2\" onClick={this.selectTab} style={{ fontSize: '20px', textAlign: 'left' }}>Monsters</Button>\r\n        <Button data-tabindex=\"3\" onClick={this.selectTab} style={{ fontSize: '20px', textAlign: 'left' }}>Backgrounds</Button>\r\n        <Button data-tabindex=\"4\" onClick={this.selectTab} style={{ fontSize: '20px', textAlign: 'left' }}>Feats</Button>\r\n        <Button data-tabindex=\"5\" onClick={this.selectTab} style={{ fontSize: '20px', textAlign: 'left' }}>Classes</Button>\r\n        <Button data-tabindex=\"6\" onClick={this.selectTab} style={{ fontSize: '20px', textAlign: 'left' }}>Races</Button>\r\n        <Button data-tabindex=\"7\" onClick={this.selectTab} style={{ fontSize: '20px', textAlign: 'left' }}>Encounter</Button>\r\n      </SwipeableDrawer>\r\n      <div className=\"container\">\r\n        {this.state.tabSelected === 0 && <SpellsTab spells={this.state.compendium.spells} />}\r\n        {this.state.tabSelected === 1 && <ItemsTab items={this.state.compendium.items} />}\r\n        {this.state.tabSelected === 2 && <MonstersTab monsters={this.state.compendium.monsters} />}\r\n        {this.state.tabSelected === 3 && <BackgroundsTab backgrounds={this.state.compendium.backgrounds} />}\r\n        {this.state.tabSelected === 4 && <FeatsTab feats={this.state.compendium.feats} />}\r\n        {this.state.tabSelected === 5 && <ClassesTab classes={this.state.compendium.classes} />}\r\n        {this.state.tabSelected === 6 && <RacesTab races={this.state.compendium.races} />}\r\n        {this.state.tabSelected === 7 && <EncounterTab game={this.state.game} />}\r\n      </div>\r\n      {this.state.snackbarMessage !== undefined && <Snackbar\r\n        key={this.state.snackbarMessage.key}\r\n        anchorOrigin={{\r\n          vertical: 'bottom',\r\n          horizontal: 'left',\r\n        }}\r\n        open={this.state.snackbarOpen}\r\n        onClose={this.handleSnackbarClosed}\r\n        onExited={this.handleSnackbarExited}\r\n        autoHideDuration={3000}\r\n        ContentProps={{\r\n          'aria-describedby': 'snackbar-message',\r\n        }}\r\n        message={<span id=\"snackbar-message\">{this.state.snackbarMessage.message}</span>} />}\r\n    </div>;\r\n  }\r\n}\r\n","import * as React from 'react';\r\nimport * as ReactDOM from 'react-dom';\r\nimport * as serviceWorker from './serviceWorker';\r\nimport { MuiThemeProvider, createMuiTheme } from '@material-ui/core/styles';\r\nimport blue from '@material-ui/core/colors/blue';\r\nimport 'typeface-roboto';\r\nimport 'react-virtualized/styles.css';\r\n\r\nimport App from './App';\r\nimport './index.css';\r\n\r\nconst theme = createMuiTheme({\r\n  palette: {\r\n  primary: blue,\r\n  },\r\n  typography: {\r\n  useNextVariants: true,\r\n  },\r\n});\r\n\r\nReactDOM.render(\r\n  <MuiThemeProvider theme={theme}>\r\n  <App />\r\n  </MuiThemeProvider>,\r\n  document.getElementById('root') as HTMLElement\r\n);\r\nserviceWorker.register();\r\n"],"sourceRoot":""}